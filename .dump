--[[RMPG Obsfucated | 2025-11-18 08:10:46 | id:544970]] (function() local __b = "bG9jYWwgbGlicmFyeSA9IGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vU29uenl4RGV2L0dQTVIvcmVmcy9oZWFkcy9tYWluL0dhcmFtb25kIiwgdHJ1ZSkpKCkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKCmxvY2FsIHVzZXJuYW1lID0gTG9jYWxQbGF5ZXIuTmFtZQpsb2NhbCBkaXNwbGF5TmFtZSA9IExvY2FsUGxheWVyLkRpc3BsYXlOYW1lCmxvY2FsIHVzZXJJZCA9IExvY2FsUGxheWVyLlVzZXJJZAoKbG9jYWwgd2luZG93ID0gbGlicmFyeTpBZGRXaW5kb3coCiAgICAiUk1QRyB8fCBGYXJtaW5nIFY0IC0gU3VwIERhd2cgWyIgLi4gdXNlcm5hbWUgLi4gIl0gLSBbIiAuLiBkaXNwbGF5TmFtZSAuLiAiXSAtIFsiIC4uIHVzZXJJZCAuLiAiXSIsCiAgICB7CiAgICAgICAgbWFpbl9jb2xvciA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDI1MCksCiAgICAgICAgbWluX3NpemUgPSBWZWN0b3IyLm5ldyg1NzAsIDE5OTApLAogICAgICAgIGNhbl9yZXNpemUgPSBmYWxzZSwKICAgIH0KKQoKbG9jYWwgRmFzdEdyaW5kID0gd2luZG93OkFkZFRhYigiRmFzdCBTdHJlbmd0aCIpCmxvY2FsIHRhYjIgPSB3aW5kb3c6QWRkVGFiKCJGYXN0IFJlYmlydGgiKQpsb2NhbCBLaWxsZXIgPSB3aW5kb3c6QWRkVGFiKCJGYXN0IEtpbGxpbmciKQpsb2NhbCB0YWIzID0gd2luZG93OkFkZFRhYigiTm9ybWFsIEZhcm0iKQpsb2NhbCBzdGF0cyA9IHdpbmRvdzpBZGRUYWIoIlN0YXRzIikKbG9jYWwgZXN0YWRpc3RpY2FzID0gd2luZG93OkFkZFRhYigiU3BlY3MiKQpsb2NhbCBNaXNjID0gd2luZG93OkFkZFRhYigiTWlzYyIpCmxvY2FsIHRhYjcgPSB3aW5kb3c6QWRkVGFiKCJDcmVkaXRzIikKCnRhYjc6U2hvdygpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGxlYWRlcnN0YXRzID0gTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJsZWFkZXJzdGF0cyIpCgpsb2NhbCBwaW5nTGFiZWwgPSBGYXN0R3JpbmQ6QWRkTGFiZWwoIlBpbmc6IENhbGN1bGF0aW5nLi4uIikKbG9jYWwgcmViaXJ0aExhYmVsID0gRmFzdEdyaW5kOkFkZExhYmVsKCJDdXJyZW50IFJlYmlydGhzOiBbMF0gfCBbMF0iKQpsb2NhbCBzdHJlbmd0aExhYmVsID0gRmFzdEdyaW5kOkFkZExhYmVsKCJDdXJyZW50IFN0cmVuZ3RoOiBbMF0gfCBbMF0iKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCgl3aGlsZSB0YXNrLndhaXQoMSkgZG8KCQlsb2NhbCBwaW5nID0gbWF0aC5mbG9vcih0b251bWJlcihnYW1lOkdldFNlcnZpY2UoIlN0YXRzIikuTmV0d29yay5TZXJ2ZXJTdGF0c0l0ZW1bIkRhdGEgUGluZyJdOkdldFZhbHVlU3RyaW5nKCk6bWF0Y2goIiVkKyIpKSBvciAwKQoJCWxvY2FsIHJlYmlydGhzID0gbGVhZGVyc3RhdHM6RmluZEZpcnN0Q2hpbGQoIlJlYmlydGhzIikgYW5kIGxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlIG9yIDAKCQlsb2NhbCBzdHJlbmd0aCA9IGxlYWRlcnN0YXRzOkZpbmRGaXJzdENoaWxkKCJTdHJlbmd0aCIpIGFuZCBsZWFkZXJzdGF0cy5TdHJlbmd0aC5WYWx1ZSBvciAwCgoJCXBpbmdMYWJlbC5UZXh0ID0gIlBpbmc6ICIgLi4gcGluZyAuLiAibXMiCgkJcmViaXJ0aExhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KCJDdXJyZW50IFJlYmlydGhzOiBbJXNdIHwgWyVzXSIsIHJlYmlydGhzID49IDEwMDAgYW5kIHN0cmluZy5mb3JtYXQoIiUuMWZrIiwgcmViaXJ0aHMgLyAxMDAwKSBvciByZWJpcnRocywgcmViaXJ0aHMpCgkJc3RyZW5ndGhMYWJlbC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiQ3VycmVudCBTdHJlbmd0aDogWyVzXSB8IFslc10iLCBzdHJlbmd0aCA+PSAxMDAwIGFuZCBzdHJpbmcuZm9ybWF0KCIlLjFmayIsIHN0cmVuZ3RoIC8gMTAwMCkgb3Igc3RyZW5ndGgsIHN0cmVuZ3RoKQoJZW5kCmVuZCkKCmxvY2FsIHN3aXRjaCA9IEZhc3RHcmluZDpBZGRTd2l0Y2goIkFudGktQUZLIiwgZnVuY3Rpb24oZW5hYmxlZCkKCWlmIGVuYWJsZWQgdGhlbgoJCWxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vU29uenl4RGV2L0dQTVIvcmVmcy9oZWFkcy9tYWluL0dhcmFtb25kVjIiKSkoKSAtLSByZXBsYWNlIHRoaXMgd2l0aCB5b3VyIEFudGktQUZLIGNvZGUgbGluawoJZWxzZQoJCWlmIGdhbWUuQ29yZUd1aTpGaW5kRmlyc3RDaGlsZCgidGhpc29uZWlzc29jb2xkd3ciKSB0aGVuCgkJCWdhbWUuQ29yZUd1aS50aGlzb25laXNzb2NvbGR3dzpEZXN0cm95KCkKCQllbmQKCWVuZAplbmQpCnN3aXRjaDpTZXQoZmFsc2UpCgpGYXN0R3JpbmQ6QWRkTGFiZWwoIkZhcm1pbmciKQoKbG9jYWwgc3dpdGNoID0gRmFzdEdyaW5kOkFkZFN3aXRjaCgiRmFzdCBTdHJlbmd0aCIsIGZ1bmN0aW9uKFZhbHVlKQoJZ2V0Z2VudigpLmlzR3JpbmRpbmcgPSBWYWx1ZQoKCWlmIG5vdCBWYWx1ZSB0aGVuIHJldHVybiBlbmQKCglmb3IgXyA9IDEsIDMwIGRvCgkJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJCXdoaWxlIGdldGdlbnYoKS5pc0dyaW5kaW5nIGRvCgkJCQlwY2FsbChmdW5jdGlvbigpCgkJCQkJZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKCQkJCWVuZCkKCQkJCXRhc2sud2FpdCgwLjAwMDUpCgkJCWVuZAoJCWVuZCkKCWVuZAplbmQpCgpsb2NhbCBhdXRvRWF0RW5hYmxlZCA9IGZhbHNlCgpsb2NhbCBmdW5jdGlvbiBlYXRQcm90ZWluRWdnKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgYmFja3BhY2sgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCiAgICBsb2NhbCBlZ2cgPSBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHJvdGVpbiBFZ2ciKQogICAgaWYgZWdnIHRoZW4KICAgICAgICBlZ2cuUGFyZW50ID0gY2hhcmFjdGVyCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBlZ2c6QWN0aXZhdGUoKQogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIGF1dG9FYXRFbmFibGVkIHRoZW4KICAgICAgICAgICAgZWF0UHJvdGVpbkVnZygpCiAgICAgICAgICAgIHRhc2sud2FpdCgzNjAwKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKRmFzdEdyaW5kOkFkZFN3aXRjaCgiQXV0byBFYXQgRWdnIHwgNjAgTWludXRlcyIsIGZ1bmN0aW9uKHN0YXRlKQogICAgYXV0b0VhdEVuYWJsZWQgPSBzdGF0ZQplbmQpCgp0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBpZiBhdXRvRWF0RW5hYmxlZCB0aGVuCiAgICAgICAgICAgIGVhdFByb3RlaW5FZ2coKQogICAgICAgICAgICB0YXNrLndhaXQoMTgwMCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRhc2sud2FpdCgxKQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCkZhc3RHcmluZDpBZGRTd2l0Y2goIkF1dG8gRWF0IEVnZyB8IDMwIE1pbnV0ZXMiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGF1dG9FYXRFbmFibGVkID0gc3RhdGUKZW5kKQoKbG9jYWwgc3dpdGNoSGlkZUZyYW1lID0gRmFzdEdyaW5kOkFkZFN3aXRjaCgiSGlkZSBGcmFtZXMiLCBmdW5jdGlvbihib29sKQogICAgZm9yIF8sIGZyYW1lTmFtZSBpbiBpcGFpcnMoeyJzdHJlbmd0aEZyYW1lIiwgImR1cmFiaWxpdHlGcmFtZSIsICJhZ2lsaXR5RnJhbWUifSkgZG8KICAgICAgICBsb2NhbCBmcmFtZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpGaW5kRmlyc3RDaGlsZChmcmFtZU5hbWUpCiAgICAgICAgaWYgZnJhbWUgYW5kIGZyYW1lOklzQSgiR3VpT2JqZWN0IikgdGhlbgogICAgICAgICAgICBmcmFtZS5WaXNpYmxlID0gbm90IGJvb2wKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpGYXN0R3JpbmQ6QWRkU3dpdGNoKCJTcGluIEZvcnR1bmUgV2hlZWwiLCBmdW5jdGlvbihzdGF0ZSkKICAgIF9HLkF1dG9TcGluV2hlZWwgPSBzdGF0ZQoKICAgIGlmIHN0YXRlIHRoZW4KICAgICAgICBzcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLkF1dG9TcGluV2hlZWwgYW5kIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuckV2ZW50cy5vcGVuRm9ydHVuZVdoZWVsUmVtb3RlOkludm9rZVNlcnZlcigKICAgICAgICAgICAgICAgICAgICAib3BlbkZvcnR1bmVXaGVlbCIsCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLmZvcnR1bmVXaGVlbENoYW5jZXNbIkZvcnR1bmUgV2hlZWwiXQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKRmFzdEdyaW5kOkFkZEJ1dHRvbigiRXF1aXAgU3dpZnQgU2FtdXJhaSIsIGZ1bmN0aW9uKCkKICAgIHByaW50KCJCb3TDs24gcHJlc2lvbmFkbzogZXF1aXBhbmRvIDggU3dpZnQgU2FtdXJhaSIpCgogICAgbG9jYWwgTG9jYWxQbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgbG9jYWwgUmVwbGljYXRlZFN0b3JhZ2UgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikKCiAgICAtLSBQcmltZXJvIGRlc2VxdWlwYW1vcyB0b2RvCiAgICBsb2NhbCBwZXRzRm9sZGVyID0gTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoInBldHNGb2xkZXIiKQogICAgaWYgbm90IHBldHNGb2xkZXIgdGhlbiByZXR1cm4gZW5kCgogICAgZm9yIF8sIGZvbGRlciBpbiBwYWlycyhwZXRzRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgZm9sZGVyOklzQSgiRm9sZGVyIikgdGhlbgogICAgICAgICAgICBmb3IgXywgcGV0IGluIHBhaXJzKGZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5lcXVpcFBldEV2ZW50OkZpcmVTZXJ2ZXIoInVuZXF1aXBQZXQiLCBwZXQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICB0YXNrLndhaXQoMC4xKQoKICAgIC0tIEFob3JhIGVxdWlwYW1vcyBtw6F4aW1vIDggIlN3aWZ0IFNhbXVyYWkiCiAgICBsb2NhbCBlcXVpcHBlZCA9IDAKICAgIGxvY2FsIG1heEVxdWlwID0gOAogICAgZm9yIF8sIGZvbGRlciBpbiBwYWlycyhwZXRzRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgZm9sZGVyOklzQSgiRm9sZGVyIikgdGhlbgogICAgICAgICAgICBmb3IgXywgcGV0IGluIHBhaXJzKGZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgaWYgcGV0Lk5hbWUgPT0gIlN3aWZ0IFNhbXVyYWkiIHRoZW4KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmVxdWlwUGV0RXZlbnQ6RmlyZVNlcnZlcigiZXF1aXBQZXQiLCBwZXQpCiAgICAgICAgICAgICAgICAgICAgZXF1aXBwZWQgKz0gMQogICAgICAgICAgICAgICAgICAgIHByaW50KCJFcXVpcGFkbyBTd2lmdCBTYW11cmFpICMiIC4uIGVxdWlwcGVkKQoKICAgICAgICAgICAgICAgICAgICBpZiBlcXVpcHBlZCA+PSBtYXhFcXVpcCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtLSBzYWxpciBjdWFuZG8geWEgaGF5YSA4IGVxdWlwYWRvcwogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgcHJpbnQoIlNlIGVxdWlwYXJvbiAiIC4uIGVxdWlwcGVkIC4uICIgU3dpZnQgU2FtdXJhaSIpCmVuZCkKCi0tLSBGYXN0IFJlYmlydGggVGFiCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIGxlYWRlcnN0YXRzID0gTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJsZWFkZXJzdGF0cyIpCgpsb2NhbCBwaW5nTGFiZWwgPSB0YWIyOkFkZExhYmVsKCJQaW5nOiBDYWxjdWxhdGluZy4uLiIpCmxvY2FsIHJlYmlydGhMYWJlbCA9IHRhYjI6QWRkTGFiZWwoIkN1cnJlbnQgUmViaXJ0aHM6IFswXSB8IFswXSIpCmxvY2FsIHN0cmVuZ3RoTGFiZWwgPSB0YWIyOkFkZExhYmVsKCJDdXJyZW50IFN0cmVuZ3RoOiBbMF0gfCBbMF0iKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCgl3aGlsZSB0YXNrLndhaXQoMSkgZG8KCQlsb2NhbCBwaW5nID0gbWF0aC5mbG9vcih0b251bWJlcihnYW1lOkdldFNlcnZpY2UoIlN0YXRzIikuTmV0d29yay5TZXJ2ZXJTdGF0c0l0ZW1bIkRhdGEgUGluZyJdOkdldFZhbHVlU3RyaW5nKCk6bWF0Y2goIiVkKyIpKSBvciAwKQoJCWxvY2FsIHJlYmlydGhzID0gbGVhZGVyc3RhdHM6RmluZEZpcnN0Q2hpbGQoIlJlYmlydGhzIikgYW5kIGxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlIG9yIDAKCQlsb2NhbCBzdHJlbmd0aCA9IGxlYWRlcnN0YXRzOkZpbmRGaXJzdENoaWxkKCJTdHJlbmd0aCIpIGFuZCBsZWFkZXJzdGF0cy5TdHJlbmd0aC5WYWx1ZSBvciAwCgoJCXBpbmdMYWJlbC5UZXh0ID0gIlBpbmc6ICIgLi4gcGluZyAuLiAibXMiCgkJcmViaXJ0aExhYmVsLlRleHQgPSBzdHJpbmcuZm9ybWF0KCJDdXJyZW50IFJlYmlydGhzOiBbJXNdIHwgWyVzXSIsIHJlYmlydGhzID49IDEwMDAgYW5kIHN0cmluZy5mb3JtYXQoIiUuMWZrIiwgcmViaXJ0aHMgLyAxMDAwKSBvciByZWJpcnRocywgcmViaXJ0aHMpCgkJc3RyZW5ndGhMYWJlbC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiQ3VycmVudCBTdHJlbmd0aDogWyVzXSB8IFslc10iLCBzdHJlbmd0aCA+PSAxMDAwIGFuZCBzdHJpbmcuZm9ybWF0KCIlLjFmayIsIHN0cmVuZ3RoIC8gMTAwMCkgb3Igc3RyZW5ndGgsIHN0cmVuZ3RoKQoJZW5kCmVuZCkKCmxvY2FsIHN3aXRjaEhpZGVGcmFtZSA9IHRhYjI6QWRkU3dpdGNoKCJIaWRlIEZyYW1lcyIsIGZ1bmN0aW9uKGJvb2wpCiAgICBmb3IgXywgZnJhbWVOYW1lIGluIGlwYWlycyh7InN0cmVuZ3RoRnJhbWUiLCAiZHVyYWJpbGl0eUZyYW1lIiwgImFnaWxpdHlGcmFtZSJ9KSBkbwogICAgICAgIGxvY2FsIGZyYW1lID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkZpbmRGaXJzdENoaWxkKGZyYW1lTmFtZSkKICAgICAgICBpZiBmcmFtZSBhbmQgZnJhbWU6SXNBKCJHdWlPYmplY3QiKSB0aGVuCiAgICAgICAgICAgIGZyYW1lLlZpc2libGUgPSBub3QgYm9vbAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCnRhYjI6QWRkU3dpdGNoKCJGYXN0IFJlYmlydGgiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGdldGdlbnYoKS5hdXRvUmViaXJ0aEp1bmdsZSA9IHN0YXRlCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCgogICAgbG9jYWwgZnVuY3Rpb24gdW5lcXVpcEFsbFBldHMoKQogICAgICAgIGZvciBfLCBmb2xkZXIgaW4gcGFpcnMocGxheWVyLnBldHNGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgaWYgZm9sZGVyOklzQSgiRm9sZGVyIikgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHBldCBpbiBwYWlycyhmb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmVxdWlwUGV0RXZlbnQ6RmlyZVNlcnZlcigidW5lcXVpcFBldCIsIHBldCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgIGVuZAoKICAgIGxvY2FsIGZ1bmN0aW9uIGVxdWlwVW5pcXVlUGV0KHBldE5hbWUpCiAgICAgICAgdW5lcXVpcEFsbFBldHMoKQogICAgICAgIHRhc2sud2FpdCgwLjAxKQogICAgICAgIGZvciBfLCBwZXQgaW4gcGFpcnMocGxheWVyLnBldHNGb2xkZXIuVW5pcXVlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIGlmIHBldC5OYW1lID09IHBldE5hbWUgdGhlbgogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5lcXVpcFBldEV2ZW50OkZpcmVTZXJ2ZXIoImVxdWlwUGV0IiwgcGV0KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvUmViaXJ0aEp1bmdsZSBkbwogICAgICAgICAgICBsb2NhbCByZWJpcnRocyA9IHBsYXllci5sZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZQogICAgICAgICAgICBsb2NhbCB0YXJnZXRTdHJlbmd0aCA9IDEwMDAwICsgKDUwMDAgKiByZWJpcnRocykKCiAgICAgICAgICAgIGlmIHBsYXllci51bHRpbWF0ZXNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIkdvbGRlbiBSZWJpcnRoIikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZ29sZGVuID0gcGxheWVyLnVsdGltYXRlc0ZvbGRlclsiR29sZGVuIFJlYmlydGgiXS5WYWx1ZQogICAgICAgICAgICAgICAgdGFyZ2V0U3RyZW5ndGggPSBtYXRoLmZsb29yKHRhcmdldFN0cmVuZ3RoICogKDEgLSAoZ29sZGVuICogMC4xKSkpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgZXF1aXBVbmlxdWVQZXQoIlN3aWZ0IFNhbXVyYWkiKQoKICAgICAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9SZWJpcnRoSnVuZ2xlIGFuZCBwbGF5ZXIubGVhZGVyc3RhdHMuU3RyZW5ndGguVmFsdWUgPCB0YXJnZXRTdHJlbmd0aCBkbwogICAgICAgICAgICAgICAgZm9yIGkgPSAxLCAxNSBkbwogICAgICAgICAgICAgICAgICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGVxdWlwVW5pcXVlUGV0KCJUcmliYWwgT3ZlcmxvcmQiKQoKICAgICAgICAgICAgbG9jYWwgY3VycmVudFJlYmlydGhzID0gcGxheWVyLmxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlCiAgICAgICAgICAgIHJlcGVhdAogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5yZWJpcnRoUmVtb3RlOkludm9rZVNlcnZlcigicmViaXJ0aFJlcXVlc3QiKQogICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDAwNSkKICAgICAgICAgICAgdW50aWwgcGxheWVyLmxlYWRlcnN0YXRzLlJlYmlydGhzLlZhbHVlID4gY3VycmVudFJlYmlydGhzCgogICAgICAgICAgICB0YXNrLndhaXQoMC4wMDA1KQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBhdXRvRWF0RW5hYmxlZCA9IGZhbHNlCgpsb2NhbCBmdW5jdGlvbiBlYXRQcm90ZWluRWdnKCkKICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcgogICAgbG9jYWwgYmFja3BhY2sgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyIG9yIHBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCiAgICBsb2NhbCBlZ2cgPSBiYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHJvdGVpbiBFZ2ciKQogICAgaWYgZWdnIHRoZW4KICAgICAgICBlZ2cuUGFyZW50ID0gY2hhcmFjdGVyCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICBlZ2c6QWN0aXZhdGUoKQogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIGF1dG9FYXRFbmFibGVkIHRoZW4KICAgICAgICAgICAgZWF0UHJvdGVpbkVnZygpCiAgICAgICAgICAgIHRhc2sud2FpdCgzNjAwKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKdGFiMjpBZGRTd2l0Y2goIkF1dG8gRWF0IEVnZyB8IDYwIE1pbnV0ZXMiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGF1dG9FYXRFbmFibGVkID0gc3RhdGUKZW5kKQoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgaWYgYXV0b0VhdEVuYWJsZWQgdGhlbgogICAgICAgICAgICBlYXRQcm90ZWluRWdnKCkKICAgICAgICAgICAgdGFzay53YWl0KDE4MDApCiAgICAgICAgZWxzZQogICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgp0YWIyOkFkZFN3aXRjaCgiQXV0byBFYXQgRWdnIHwgMzAgTWludXRlcyIsIGZ1bmN0aW9uKHN0YXRlKQogICAgYXV0b0VhdEVuYWJsZWQgPSBzdGF0ZQplbmQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIHBsYXllcldoaXRlbGlzdCA9IHt9CmxvY2FsIHRhcmdldFBsYXllck5hbWVzID0ge30KbG9jYWwgYXV0b0dvb2RLYXJtYSA9IGZhbHNlCmxvY2FsIGF1dG9CYWRLYXJtYSA9IGZhbHNlCmxvY2FsIGF1dG9LaWxsID0gZmFsc2UKbG9jYWwga2lsbFRhcmdldCA9IGZhbHNlCmxvY2FsIHNweWluZyA9IGZhbHNlCmxvY2FsIGF1dG9FcXVpcFB1bmNoID0gZmFsc2UKbG9jYWwgYXV0b1B1bmNoTm9BbmltID0gZmFsc2UKbG9jYWwgdGFyZ2V0RHJvcGRvd25JdGVtcyA9IHt9CmxvY2FsIGF2YWlsYWJsZVRhcmdldHMgPSB7fQoKbG9jYWwgZHJvcGRvd24gPSBLaWxsZXI6QWRkRHJvcGRvd24oIlNlbGVjdCBQZXQiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgcGV0c0ZvbGRlciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoInBldHNGb2xkZXIiKQogICAgZm9yIF8sIGZvbGRlciBpbiBwYWlycyhwZXRzRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgZm9sZGVyOklzQSgiRm9sZGVyIikgdGhlbgogICAgICAgICAgICBmb3IgXywgcGV0IGluIHBhaXJzKGZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLnJFdmVudHMuZXF1aXBQZXRFdmVudDpGaXJlU2VydmVyKCJ1bmVxdWlwUGV0IiwgcGV0KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgdGFzay53YWl0KDAuMikKICAgIGxvY2FsIHBldE5hbWUgPSB0ZXh0CiAgICBsb2NhbCBwZXRzVG9FcXVpcCA9IHt9CiAgICBmb3IgXywgcGV0IGluIHBhaXJzKHBldHNGb2xkZXIuVW5pcXVlOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgcGV0Lk5hbWUgPT0gcGV0TmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChwZXRzVG9FcXVpcCwgcGV0KQogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBtYXhQZXRzID0gOAogICAgbG9jYWwgZXF1aXBwZWRDb3VudCA9IG1hdGgubWluKCNwZXRzVG9FcXVpcCwgbWF4UGV0cykKICAgIGZvciBpID0gMSwgZXF1aXBwZWRDb3VudCBkbwogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmVxdWlwUGV0RXZlbnQ6RmlyZVNlcnZlcigiZXF1aXBQZXQiLCBwZXRzVG9FcXVpcFtpXSkKICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgZW5kCmVuZCkKZHJvcGRvd246QWRkKCJXaWxkIFdpemFyZCIpCmRyb3Bkb3duOkFkZCgiTWlnaHR5IE1vbnN0ZXIiKQoKS2lsbGVyOkFkZFN3aXRjaCgiQXV0byBQdW5jaCBbTm8gQW5pbWF0aW9uXSIsIGZ1bmN0aW9uKHN0YXRlKQoJYXV0b1B1bmNoTm9BbmltID0gc3RhdGUKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCXdoaWxlIGF1dG9QdW5jaE5vQW5pbSBkbwoJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCWlmIHB1bmNoIHRoZW4KCQkJCWlmIHB1bmNoLlBhcmVudCB+PSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgdGhlbgoJCQkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJZW5kCgkJCQlMb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJyaWdodEhhbmQiKQoJCQkJTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCAibGVmdEhhbmQiKQoJCQllbHNlCgkJCQlhdXRvUHVuY2hOb0FuaW0gPSBmYWxzZQoJCQllbmQKCQkJdGFzay53YWl0KDAuMDEpCgkJZW5kCgllbmQpCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gUHVuY2giLCBmdW5jdGlvbihzdGF0ZSkKCV9HLmZhc3RIaXRBY3RpdmUgPSBzdGF0ZQoJaWYgc3RhdGUgdGhlbgoJCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCQl3aGlsZSBfRy5mYXN0SGl0QWN0aXZlIGRvCgkJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlpZiBwdW5jaCB0aGVuCgkJCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCQkJaWYgcHVuY2g6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCgkJCQkJCXB1bmNoLmF0dGFja1RpbWUuVmFsdWUgPSAwCgkJCQkJZW5kCgkJCQllbmQKCQkJCXRhc2sud2FpdCgwLjEpCgkJCWVuZAoJCWVuZCkKCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuZmFzdEhpdEFjdGl2ZSBkbwoJCQkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCQkJaWYgcHVuY2ggdGhlbgoJCQkJCXB1bmNoOkFjdGl2YXRlKCkKCQkJCWVuZAoJCQkJdGFzay53YWl0KDAuMSkKCQkJZW5kCgkJZW5kKQoJZWxzZQoJCWxvY2FsIHB1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQlpZiBwdW5jaCB0aGVuCgkJCXB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkJhY2twYWNrCgkJZW5kCgllbmQKZW5kKQoKS2lsbGVyOkFkZFN3aXRjaCgiRmFzdCBQdW5jaCIsIGZ1bmN0aW9uKHN0YXRlKQoJX0cuYXV0b1B1bmNoQWN0aXZlID0gc3RhdGUKCWlmIHN0YXRlIHRoZW4KCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuYXV0b1B1bmNoQWN0aXZlIGRvCgkJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlpZiBwdW5jaCB0aGVuCgkJCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCgkJCQkJaWYgcHVuY2g6RmluZEZpcnN0Q2hpbGQoImF0dGFja1RpbWUiKSB0aGVuCgkJCQkJCXB1bmNoLmF0dGFja1RpbWUuVmFsdWUgPSAwCgkJCQkJZW5kCgkJCQllbmQKCQkJCXRhc2sud2FpdCgpCgkJCWVuZAoJCWVuZCkKCQl0YXNrLnNwYXduKGZ1bmN0aW9uKCkKCQkJd2hpbGUgX0cuYXV0b1B1bmNoQWN0aXZlIGRvCgkJCQlsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCgkJCQlpZiBwdW5jaCB0aGVuCgkJCQkJcHVuY2g6QWN0aXZhdGUoKQoJCQkJZW5kCgkJCQl0YXNrLndhaXQoKQoJCQllbmQKCQllbmQpCgllbHNlCgkJbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgYW5kIExvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQoJCWlmIHB1bmNoIHRoZW4KCQkJcHVuY2guUGFyZW50ID0gTG9jYWxQbGF5ZXIuQmFja3BhY2sKCQllbmQKCWVuZAplbmQpCgpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikKbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCmxvY2FsIFN0YXJ0ZXJQYWNrID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyUGFjayIpCmxvY2FsIGxpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgoKLS0gU3RhdGUgJiBjb25uZWN0aW9uIHRyYWNraW5nCmxvY2FsIGNvbWJvQWN0aXZlID0gZmFsc2UKbG9jYWwgY29ubmVjdGlvbnMgPSB7fSAtLSBtYXAga2V5cyAtPiBSQlhTY3JpcHRDb25uZWN0aW9uIC8gdGFzay50aHJlYWQKbG9jYWwgbG9vcHMgPSB7fSAtLSBzdG9yZSBjb3JvdXRpbmUvdGhyZWFkIHJlZmVyZW5jZXMgdG8gYWxsb3cgc2FmZSBzdG9wcGluZwoKbG9jYWwgZnVuY3Rpb24gc2FmZURpc2Nvbm5lY3Qoa2V5KQoJbG9jYWwgY29ubiA9IGNvbm5lY3Rpb25zW2tleV0KCWlmIG5vdCBjb25uIHRoZW4gcmV0dXJuIGVuZAoJcGNhbGwoZnVuY3Rpb24oKQoJCWlmIHR5cGVvZihjb25uKSA9PSAiUkJYU2NyaXB0Q29ubmVjdGlvbiIgYW5kIGNvbm4uRGlzY29ubmVjdCB0aGVuCgkJCWNvbm46RGlzY29ubmVjdCgpCgkJZWxzZWlmIHR5cGUoY29ubikgPT0gInRhYmxlIiBhbmQgY29ubi5EaXNjb25uZWN0IHRoZW4KCQkJY29ubjpEaXNjb25uZWN0KCkKCQllbmQKCWVuZCkKCWNvbm5lY3Rpb25zW2tleV0gPSBuaWwKZW5kCgpsb2NhbCBmdW5jdGlvbiBzdG9wTG9vcHMoKQoJZm9yIGssIHRociBpbiBwYWlycyhsb29wcykgZG8KCQlsb29wc1trXSA9IG5pbAoJZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gY2xlYW51cEFsbCgpCglfRy5BdXRvUHVuY2hUb2dnbGUgPSBmYWxzZQoJX0cuQXV0b1Byb3RlaW5FZ2cgPSBmYWxzZQoJZ2V0Z2VudigpLkFudGlGbHlBY3RpdmUgPSBmYWxzZQoKCWZvciBrLCBfIGluIHBhaXJzKGNvbm5lY3Rpb25zKSBkbwoJCXNhZmVEaXNjb25uZWN0KGspCgllbmQKCWNvbm5lY3Rpb25zID0ge30KCXN0b3BMb29wcygpCmVuZAoKbG9jYWwgZnVuY3Rpb24gcmVzcGF3blBsYXllcigpCglwY2FsbChmdW5jdGlvbigpCgkJaWYgTG9jYWxQbGF5ZXIgYW5kIExvY2FsUGxheWVyOklzQSgiUGxheWVyIikgdGhlbgoJCQlpZiBwY2FsbChmdW5jdGlvbigpIExvY2FsUGxheWVyOkxvYWRDaGFyYWN0ZXIoKSBlbmQpIHRoZW4gcmV0dXJuIGVuZAoJCQlwY2FsbChmdW5jdGlvbigpCgkJCQlsb2NhbCBTdGFydGVyR3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIikKCQkJCVN0YXJ0ZXJHdWk6U2V0Q29yZSgiUmVzZXRCdXR0b25DYWxsYmFjayIsIHRydWUpCgkJCWVuZCkKCQllbmQKCWVuZCkKZW5kCgpsb2NhbCBmdW5jdGlvbiBhcHBseVNpemVOYU4oKQoJcGNhbGwoZnVuY3Rpb24oKQoJCWxvY2FsIGV2ZW50cyA9IFJlcGxpY2F0ZWRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJyRXZlbnRzIikKCQlpZiBldmVudHMgdGhlbgoJCQlsb2NhbCBjaGFuZ2UgPSBldmVudHM6RmluZEZpcnN0Q2hpbGQoImNoYW5nZVNwZWVkU2l6ZVJlbW90ZSIpCgkJCWlmIGNoYW5nZSBhbmQgY2hhbmdlLkludm9rZVNlcnZlciB0aGVuCgkJCQlwY2FsbChmdW5jdGlvbigpCgkJCQkJY2hhbmdlOkludm9rZVNlcnZlcigiY2hhbmdlU2l6ZSIsIDAvMCkKCQkJCWVuZCkKCQkJZW5kCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RhcnRBdXRvUHVuY2goKQoJX0cuQXV0b1B1bmNoVG9nZ2xlID0gdHJ1ZQoJbG9jYWwgaWQgPSAiQXV0b1B1bmNoIgoJbG9vcHNbaWRdID0gdHJ1ZQoJdGFzay5zcGF3bihmdW5jdGlvbigpCgkJbG9jYWwgYmFja3BhY2sgPSBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikKCQlsb2NhbCBoYW5kID0gInJpZ2h0SGFuZCIKCQlsb2NhbCBmdW5jdGlvbiBnZXRNdXNjbGVFdmVudCgpIHJldHVybiBMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgibXVzY2xlRXZlbnQiKSBlbmQKCgkJc2FmZURpc2Nvbm5lY3QoIkNoYXJBZGRlZEZvckF1dG9QdW5jaCIpCgkJY29ubmVjdGlvbnMuQ2hhckFkZGVkRm9yQXV0b1B1bmNoID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyKQoJCQlpZiBjb21ib0FjdGl2ZSBhbmQgY29ubmVjdGlvbnMuSHVtYW5vaWRSZXNldEhvb2sgPT0gbmlsIHRoZW4KCQkJCWxvY2FsIGh1bSA9IGNoYXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpCgkJCQlpZiBodW0gdGhlbgoJCQkJCXNhZmVEaXNjb25uZWN0KCJSZXNldERlYXRoIikKCQkJCQljb25uZWN0aW9ucy5SZXNldERlYXRoID0gaHVtLkRpZWQ6Q29ubmVjdChmdW5jdGlvbigpCgkJCQkJCXRhc2sud2FpdCgwLjUpCgkJCQkJCXJlc3Bhd25QbGF5ZXIoKQoJCQkJCWVuZCkKCQkJCWVuZAoJCQllbmQKCQllbmQpCgoJCXNhZmVEaXNjb25uZWN0KCJCYWNrcGFja0NoaWxkRm9yQXV0b1B1bmNoIikKCQljb25uZWN0aW9ucy5CYWNrcGFja0NoaWxkRm9yQXV0b1B1bmNoID0gTG9jYWxQbGF5ZXIuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQoJCQlpZiBjaGlsZC5OYW1lID09ICJCYWNrcGFjayIgdGhlbgoJCQkJYmFja3BhY2sgPSBjaGlsZAoJCQllbmQKCQllbmQpCgoJCXdoaWxlIF9HLkF1dG9QdW5jaFRvZ2dsZSBhbmQgbG9vcHNbaWRdIGRvCgkJCWxvY2FsIG11c2NsZUV2ZW50ID0gZ2V0TXVzY2xlRXZlbnQoKQoJCQlsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQkJaWYgY2hhcmFjdGVyIGFuZCBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgYW5kIG11c2NsZUV2ZW50IHRoZW4KCQkJCWxvY2FsIHB1bmNoRXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKCQkJCWxvY2FsIHB1bmNoSW5CYWNrcGFjayA9IChMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBhbmQgTG9jYWxQbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikpCgkJCQlpZiBub3QgcHVuY2hFcXVpcHBlZCBhbmQgcHVuY2hJbkJhY2twYWNrIHRoZW4KCQkJCQlwY2FsbChmdW5jdGlvbigpIGNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wocHVuY2hJbkJhY2twYWNrKSBlbmQpCgkJCQllbmQKCQkJCXBjYWxsKGZ1bmN0aW9uKCkgbXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicHVuY2giLCBoYW5kKSBlbmQpCgkJCWVuZAoJCQl0YXNrLndhaXQoMC4wMDAxKQoJCWVuZAoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHN0YXJ0UHJvdGVpbkVnZ0xvZ2ljKCkKCV9HLkF1dG9Qcm90ZWluRWdnID0gdHJ1ZQoJbG9jYWwgaWQgPSAiUHJvdGVpbkVnZyIKCWxvb3BzW2lkXSA9IHRydWUKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCWxvY2FsIHRvb2xOYW1lID0gIlByb3RlaW4gRWdnIgoJCWxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBvciBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCkKCgkJbG9jYWwgZnVuY3Rpb24gcmVzdG9yZVZpc2liaWxpdHkodG9vbCkKCQkJZm9yIF8sIHBhcnQgaW4gaXBhaXJzKHRvb2w6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCWlmIHBhcnQ6SXNBKCJCYXNlUGFydCIpIHRoZW4KCQkJCQlwY2FsbChmdW5jdGlvbigpIHBhcnQuVHJhbnNwYXJlbmN5ID0gMCBlbmQpCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBwYXJ0LkxvY2FsVHJhbnNwYXJlbmN5TW9kaWZpZXIgPSAwIGVuZCkKCQkJCWVuZAoJCQllbmQKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gZmluZFRvb2woKQoJCQlsb2NhbCB0b29sID0gKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIGFuZCBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkpCgkJCWlmIHRvb2wgdGhlbiByZXR1cm4gdG9vbCBlbmQKCQkJdG9vbCA9IFN0YXJ0ZXJQYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQoJCQlpZiB0b29sIHRoZW4gcmV0dXJuIHRvb2wgZW5kCgkJCXRvb2wgPSBSZXBsaWNhdGVkU3RvcmFnZTpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkKCQkJcmV0dXJuIHRvb2wKCQllbmQKCgkJbG9jYWwgZnVuY3Rpb24gZm9yY2VFcXVpcCh0b29sKQoJCQlpZiBub3QgKGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpKSB0aGVuIHJldHVybiBlbmQKCQkJcGNhbGwoZnVuY3Rpb24oKSBjaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHRvb2wpIGVuZCkKCQkJdGFzay53YWl0KDAuMSkKCQkJaWYgbm90IGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCh0b29sTmFtZSkgdGhlbgoJCQkJcGNhbGwoZnVuY3Rpb24oKSB0b29sLlBhcmVudCA9IGNoYXJhY3RlciBlbmQpCgkJCQl0YXNrLndhaXQoMC4xKQoJCQllbmQKCQkJbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCgkJCWlmIGVxdWlwcGVkIHRoZW4gcmVzdG9yZVZpc2liaWxpdHkoZXF1aXBwZWQpIGVuZAoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBzYW5pdGl6ZVRvb2wodG9vbCkKCQkJZm9yIF8sIGRlc2MgaW4gaXBhaXJzKHRvb2w6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCWlmIGRlc2M6SXNBKCJTY3JpcHQiKSB0aGVuCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBkZXNjOkRlc3Ryb3koKSBlbmQpCgkJCQllbHNlaWYgZGVzYzpJc0EoIkxvY2FsU2NyaXB0IikgdGhlbgoJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgZGVzYy5EaXNhYmxlZCA9IHRydWUgZW5kKQoJCQkJZW5kCgkJCQlpZiBkZXNjOklzQSgiUmVtb3RlRXZlbnQiKSB0aGVuCgkJCQkJcGNhbGwoZnVuY3Rpb24oKSBkZXNjLkZpcmVTZXJ2ZXIgPSBmdW5jdGlvbigpIGVuZCBlbmQpCgkJCQllbmQKCQkJZW5kCgkJZW5kCgoJCWxvY2FsIGZ1bmN0aW9uIGVxdWlwSWZOZWVkZWQoKQoJCQlpZiBub3QgX0cuQXV0b1Byb3RlaW5FZ2cgdGhlbiByZXR1cm4gZW5kCgkJCWNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQlsb2NhbCBlcXVpcHBlZCA9IGNoYXJhY3RlciBhbmQgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQoJCQlsb2NhbCBuZWVkRXF1aXAgPSBmYWxzZQoJCQlpZiBub3QgZXF1aXBwZWQgdGhlbgoJCQkJbmVlZEVxdWlwID0gdHJ1ZQoJCQllbHNlCgkJCQlmb3IgXywgcGFydCBpbiBpcGFpcnMoZXF1aXBwZWQ6R2V0RGVzY2VuZGFudHMoKSkgZG8KCQkJCQlpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFydC5UcmFuc3BhcmVuY3kgPiAwIHRoZW4KCQkJCQkJbmVlZEVxdWlwID0gdHJ1ZQoJCQkJCQlicmVhawoJCQkJCWVuZAoJCQkJZW5kCgkJCWVuZAoJCQlpZiBuZWVkRXF1aXAgdGhlbgoJCQkJbG9jYWwgdG9vbCA9IGZpbmRUb29sKCkKCQkJCWlmIHRvb2wgdGhlbgoJCQkJCWlmIHRvb2wuUGFyZW50IH49IChMb2NhbFBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQmFja3BhY2siKSBhbmQgTG9jYWxQbGF5ZXIuQmFja3BhY2spIHRoZW4KCQkJCQkJbG9jYWwgY2xvbmUgPSB0b29sOkNsb25lKCkKCQkJCQkJY2xvbmUuUGFyZW50ID0gTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkJhY2twYWNrIikgb3IgTG9jYWxQbGF5ZXIKCQkJCQkJdG9vbCA9IGNsb25lCgkJCQkJZW5kCgkJCQkJc2FuaXRpemVUb29sKHRvb2wpCgkJCQkJZm9yY2VFcXVpcCh0b29sKQoJCQkJZW5kCgkJCWVuZAoJCWVuZAoKCQlsb2NhbCBmdW5jdGlvbiBtb25pdG9yVG9vbENvbnRhaW5lcihjb250YWluZXIpCgkJCWlmIG5vdCBjb250YWluZXIgdGhlbiByZXR1cm4gZW5kCgkJCWZvciBfLCB0b29sIGluIGlwYWlycyhjb250YWluZXI6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCWlmIHRvb2w6SXNBKCJUb29sIikgYW5kIHRvb2wuTmFtZSA9PSB0b29sTmFtZSB0aGVuCgkJCQkJc2FuaXRpemVUb29sKHRvb2wpCgkJCQllbmQKCQkJZW5kCgkJCWxvY2FsIGNvbm4gPSBjb250YWluZXIuQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoaWxkKQoJCQkJaWYgY2hpbGQ6SXNBKCJUb29sIikgYW5kIGNoaWxkLk5hbWUgPT0gdG9vbE5hbWUgdGhlbgoJCQkJCXRhc2suZGVmZXIoZnVuY3Rpb24oKQoJCQkJCQlzYW5pdGl6ZVRvb2woY2hpbGQpCgkJCQkJZW5kKQoJCQkJZW5kCgkJCWVuZCkKCQkJcmV0dXJuIGNvbm4KCQllbmQKCgkJc2FmZURpc2Nvbm5lY3QoIk1vbml0b3JCYWNrcGFjayIpCgkJc2FmZURpc2Nvbm5lY3QoIk1vbml0b3JDaGFyYWN0ZXIiKQoJCWNvbm5lY3Rpb25zLk1vbml0b3JCYWNrcGFjayA9IG1vbml0b3JUb29sQ29udGFpbmVyKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIG9yIExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKSkKCQljb25uZWN0aW9ucy5Nb25pdG9yQ2hhcmFjdGVyID0gbW9uaXRvclRvb2xDb250YWluZXIoTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKQoKCQlzYWZlRGlzY29ubmVjdCgiQ2hhcmFjdGVyQWRkZWRQcm90ZWluIikKCQljb25uZWN0aW9ucy5DaGFyYWN0ZXJBZGRlZFByb3RlaW4gPSBMb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGNoYXIpCgkJCWNoYXJhY3RlciA9IGNoYXIKCQkJdGFzay53YWl0KDEpCgkJCXNhZmVEaXNjb25uZWN0KCJNb25pdG9yQmFja3BhY2siKQoJCQlzYWZlRGlzY29ubmVjdCgiTW9uaXRvckNoYXJhY3RlciIpCgkJCWNvbm5lY3Rpb25zLk1vbml0b3JCYWNrcGFjayA9IG1vbml0b3JUb29sQ29udGFpbmVyKExvY2FsUGxheWVyOkZpbmRGaXJzdENoaWxkKCJCYWNrcGFjayIpIG9yIExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKSkKCQkJY29ubmVjdGlvbnMuTW9uaXRvckNoYXJhY3RlciA9IG1vbml0b3JUb29sQ29udGFpbmVyKGNoYXIpCgkJCWVxdWlwSWZOZWVkZWQoKQoJCWVuZCkKCgkJc2FmZURpc2Nvbm5lY3QoIkJhY2twYWNrQ2hpbGRQcm90ZWluIikKCQljb25uZWN0aW9ucy5CYWNrcGFja0NoaWxkUHJvdGVpbiA9IExvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKS5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCgkJCWlmIF9HLkF1dG9Qcm90ZWluRWdnIGFuZCBjaGlsZC5OYW1lID09IHRvb2xOYW1lIHRoZW4KCQkJCXRhc2sud2FpdCgwLjIpCgkJCQllcXVpcElmTmVlZGVkKCkKCQkJZW5kCgkJZW5kKQoKCQl3aGlsZSBfRy5BdXRvUHJvdGVpbkVnZyBhbmQgbG9vcHNbaWRdIGRvCgkJCXBjYWxsKGVxdWlwSWZOZWVkZWQpCgkJCXRhc2sud2FpdCgwLjUpCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RhcnRBbnRpRmx5KCkKCWdldGdlbnYoKS5BbnRpRmx5QWN0aXZlID0gdHJ1ZQoJc2FmZURpc2Nvbm5lY3QoIkFudGlGbHkiKQoJY29ubmVjdGlvbnMuQW50aUZseSA9IFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQoJCWxvY2FsIGNoYXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKCQlpZiBub3QgY2hhciB0aGVuIHJldHVybiBlbmQKCQlsb2NhbCByb290ID0gY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCgkJaWYgbm90IHJvb3QgdGhlbiByZXR1cm4gZW5kCgkJbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKQoJCWlmIG5vdCBodW1hbm9pZCB0aGVuIHJldHVybiBlbmQKCQlsb2NhbCByYXkgPSBSYXkubmV3KHJvb3QuUG9zaXRpb24sIFZlY3RvcjMubmV3KDAsIC01MDAsIDApKQoJCWxvY2FsIGhpdCwgcG9zaXRpb24gPSB3b3Jrc3BhY2U6RmluZFBhcnRPblJheShyYXksIGNoYXIpCgkJaWYgaGl0IHRoZW4KCQkJbG9jYWwgZ3JvdW5kWSA9IHBvc2l0aW9uLlkKCQkJbG9jYWwgY3VycmVudFkgPSByb290LlBvc2l0aW9uLlkKCQkJaWYgY3VycmVudFkgLSBncm91bmRZID4gMC41IHRoZW4KCQkJCXJvb3QuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhyb290LlBvc2l0aW9uLlgsIGdyb3VuZFkgKyAwLjUsIHJvb3QuUG9zaXRpb24uWikKCQkJCWh1bWFub2lkLlBsYXRmb3JtU3RhbmQgPSB0cnVlCgkJCQlodW1hbm9pZC5QbGF0Zm9ybVN0YW5kID0gZmFsc2UKCQkJZW5kCgkJZW5kCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc29mdEFudGlMYWdBbmRTdW5zZXQoKQoJcGNhbGwoZnVuY3Rpb24oKQoJCWxvY2FsIGNsYXNzZXNUb0NsZWFuID0ge1siUGFydGljbGVFbWl0dGVyIl09dHJ1ZSwgWyJUcmFpbCJdPXRydWUsIFsiU21va2UiXT10cnVlLCBbIkZpcmUiXT10cnVlfQoJCWZvciBfLCBvYmogaW4gaXBhaXJzKHdvcmtzcGFjZTpHZXRDaGlsZHJlbigpKSBkbwoJCQlpZiBvYmo6SXNBKCJNb2RlbCIpIG9yIG9iajpJc0EoIlBhcnQiKSB0aGVuCgkJCQlmb3IgXywgc3ViIGluIGlwYWlycyhvYmo6R2V0Q2hpbGRyZW4oKSkgZG8KCQkJCQlpZiBjbGFzc2VzVG9DbGVhbltzdWIuQ2xhc3NOYW1lXSB0aGVuCgkJCQkJCXBjYWxsKGZ1bmN0aW9uKCkgc3ViOkRlc3Ryb3koKSBlbmQpCgkJCQkJZW5kCgkJCQllbmQKCQkJZW5kCgkJZW5kCgkJbG9jYWwgdGVycmFpbiA9IHdvcmtzcGFjZTpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIlRlcnJhaW4iKQoJCWlmIHRlcnJhaW4gdGhlbgoJCQl0ZXJyYWluLldhdGVyV2F2ZVNpemUgPSAwCgkJCXRlcnJhaW4uV2F0ZXJSZWZsZWN0YW5jZSA9IDAKCQkJdGVycmFpbi5XYXRlclRyYW5zcGFyZW5jeSA9IDEKCQllbmQKCWVuZCkKCXBjYWxsKGZ1bmN0aW9uKCkKCQlsaWdodGluZy5DbG9ja1RpbWUgPSAxOAoJCWxpZ2h0aW5nLkJyaWdodG5lc3MgPSAxLjUKCQlsaWdodGluZy5PdXRkb29yQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDE1MCwgMTAwLCA4MCkKCQlsaWdodGluZy5Gb2dDb2xvciA9IENvbG9yMy5mcm9tUkdCKDIwMCwgMTIwLCAxMDApCgkJbGlnaHRpbmcuRm9nRW5kID0gNTAwCgkJZm9yIF8sIHYgaW4gaXBhaXJzKGxpZ2h0aW5nOkdldENoaWxkcmVuKCkpIGRvCgkJCWlmIHY6SXNBKCJTa3kiKSB0aGVuCgkJCQlwY2FsbChmdW5jdGlvbigpIHY6RGVzdHJveSgpIGVuZCkKCQkJZW5kCgkJZW5kCgkJbG9jYWwgc2t5ID0gSW5zdGFuY2UubmV3KCJTa3kiKQoJCXNreS5OYW1lID0gIlN1bnNldFNreSIKCQlza3kuU2t5Ym94QmsgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94RG4gPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94RnQgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94TGYgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94UnQgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU2t5Ym94VXAgPSAicmJ4YXNzZXRpZDovLzEzMTg4OTAxNyIKCQlza3kuU3VuQW5ndWxhclNpemUgPSAxMAoJCXNreS5Nb29uQW5ndWxhclNpemUgPSAwCgkJc2t5LlN1blRleHR1cmVJZCA9ICJyYnhhc3NldGlkOi8vNjQ0NDMyOTkyIgoJCXNreS5QYXJlbnQgPSBsaWdodGluZwoJZW5kKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGhvb2tSZXNldE9uQ2hhcmFjdGVyKGNoYXIpCglpZiBub3QgY2hhciB0aGVuIHJldHVybiBlbmQKCWxvY2FsIGh1bWFub2lkID0gY2hhcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikKCXNhZmVEaXNjb25uZWN0KCJSZXNldERlYXRoIikKCWNvbm5lY3Rpb25zLlJlc2V0RGVhdGggPSBodW1hbm9pZC5EaWVkOkNvbm5lY3QoZnVuY3Rpb24oKQoJCXRhc2sud2FpdCgwLjUpCgkJcmVzcGF3blBsYXllcigpCgllbmQpCmVuZAoKbG9jYWwgZnVuY3Rpb24gc3RhcnRUaW55SXNsYW5kTG9vcCgpCglsb2NhbCBpZCA9ICJUaW55SXNsYW5kTG9vcCIKCWxvb3BzW2lkXSA9IHRydWUKCXRhc2suc3Bhd24oZnVuY3Rpb24oKQoJCWxvY2FsIHRlbGVwb3J0UG9zID0gQ0ZyYW1lLm5ldygtMzcuMSwgOS4yLCAxOTE5KQoJCXdoaWxlIGNvbWJvQWN0aXZlIGFuZCBsb29wc1tpZF0gZG8KCQkJcGNhbGwoZnVuY3Rpb24oKQoJCQkJbG9jYWwgY2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgoJCQkJaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KCQkJCQljaGFyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gdGVsZXBvcnRQb3MKCQkJCWVuZAoJCQllbmQpCgkJCXRhc2sud2FpdCgwLjIpCgkJZW5kCgllbmQpCmVuZAoKLS0g8J+UuSBLaWxsZXI6QWRkU3dpdGNoIHZlcnNpb24KS2lsbGVyOkFkZFN3aXRjaCgiT1AgUHVuY2ggV2hlbiBEZWFkIHwgQ29tYm8iLCBmdW5jdGlvbihlbmFibGVkKQoJY29tYm9BY3RpdmUgPSBlbmFibGVkCgljbGVhbnVwQWxsKCkKCglpZiBlbmFibGVkIHRoZW4KCQlhcHBseVNpemVOYU4oKQoJCXN0YXJ0QXV0b1B1bmNoKCkKCQlzdGFydFByb3RlaW5FZ2dMb2dpYygpCgkJc3RhcnRBbnRpRmx5KCkKCQlzb2Z0QW50aUxhZ0FuZFN1bnNldCgpCgkJc3RhcnRUaW55SXNsYW5kTG9vcCgpCgoJCWlmIExvY2FsUGxheWVyLkNoYXJhY3RlciB0aGVuCgkJCWhvb2tSZXNldE9uQ2hhcmFjdGVyKExvY2FsUGxheWVyLkNoYXJhY3RlcikKCQllbmQKCQlzYWZlRGlzY29ubmVjdCgiQ2hhcmFjdGVyQWRkZWRSZXNldCIpCgkJY29ubmVjdGlvbnMuQ2hhcmFjdGVyQWRkZWRSZXNldCA9IExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hhcikKCQkJdGFzay53YWl0KDAuNSkKCQkJaG9va1Jlc2V0T25DaGFyYWN0ZXIoY2hhcikKCQllbmQpCgllbmQKZW5kKQoKS2lsbGVyOkFkZEJ1dHRvbigiTmFOIFNpemUiLCBmdW5jdGlvbigpCiAgICBsb2NhbCBhcmdzID0geyJjaGFuZ2VTaXplIiwgMC8wfQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgickV2ZW50cyIpOldhaXRGb3JDaGlsZCgiY2hhbmdlU3BlZWRTaXplUmVtb3RlIik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKZW5kKQoKbG9jYWwgYnV0dG9uID0gS2lsbGVyOkFkZEJ1dHRvbigiUmVtb3ZlIFB1bmNoIEFuaW0iLCBmdW5jdGlvbigpCiAgICBsb2NhbCBibG9ja2VkQW5pbWF0aW9ucyA9IHsKICAgICAgICBbInJieGFzc2V0aWQ6Ly8zNjM4NzI5MDUzIl0gPSB0cnVlLAogICAgICAgIFsicmJ4YXNzZXRpZDovLzM2Mzg3Njc0MjciXSA9IHRydWUsCiAgICB9CgogICAgbG9jYWwgZnVuY3Rpb24gc2V0dXBBbmltYXRpb25CbG9ja2luZygpCiAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICBpZiBub3QgY2hhciBvciBub3QgY2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuIHJldHVybiBlbmQKCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCgogICAgICAgIGZvciBfLCB0cmFjayBpbiBwYWlycyhodW1hbm9pZDpHZXRQbGF5aW5nQW5pbWF0aW9uVHJhY2tzKCkpIGRvCiAgICAgICAgICAgIGlmIHRyYWNrLkFuaW1hdGlvbiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBhbmltSWQgPSB0cmFjay5BbmltYXRpb24uQW5pbWF0aW9uSWQKICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1OYW1lID0gdHJhY2suTmFtZTpsb3dlcigpCgogICAgICAgICAgICAgICAgaWYgYmxvY2tlZEFuaW1hdGlvbnNbYW5pbUlkXSBvcgogICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJwdW5jaCIpIG9yCiAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goImF0dGFjayIpIG9yCiAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInJpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNvbm5lY3Rpb24gPSBodW1hbm9pZC5BbmltYXRpb25QbGF5ZWQ6Q29ubmVjdChmdW5jdGlvbih0cmFjaykKICAgICAgICAgICAgICAgIGlmIHRyYWNrLkFuaW1hdGlvbiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbUlkID0gdHJhY2suQW5pbWF0aW9uLkFuaW1hdGlvbklkCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgYmxvY2tlZEFuaW1hdGlvbnNbYW5pbUlkXSBvcgogICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicHVuY2giKSBvcgogICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInJpZ2h0IikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0cmFjazpTdG9wKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCgogICAgICAgICAgICBfRy5BbmltQmxvY2tDb25uZWN0aW9uID0gY29ubmVjdGlvbgogICAgICAgIGVuZAogICAgZW5kCgogICAgc2V0dXBBbmltYXRpb25CbG9ja2luZygpCgogICAgbG9jYWwgZnVuY3Rpb24gb3ZlcnJpZGVUb29sQWN0aXZhdGlvbigpCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gcHJvY2Vzc1Rvb2wodG9vbCkKICAgICAgICAgICAgaWYgdG9vbCBhbmQgKHRvb2wuTmFtZSA9PSAiUHVuY2giIG9yIHRvb2wuTmFtZTptYXRjaCgiQXR0YWNrIikgb3IgdG9vbC5OYW1lOm1hdGNoKCJSaWdodCIpKSB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgdG9vbDpHZXRBdHRyaWJ1dGUoIkFjdGl2YXRlZE92ZXJyaWRlIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHRvb2w6U2V0QXR0cmlidXRlKCJBY3RpdmF0ZWRPdmVycmlkZSIsIHRydWUpCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNvbm5lY3Rpb24gPSB0b29sLkFjdGl2YXRlZDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMDUpCgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLCB0cmFjayBpbiBwYWlycyhjaGFyLkh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0cmFjay5BbmltYXRpb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhbmltSWQgPSB0cmFjay5BbmltYXRpb24uQW5pbWF0aW9uSWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJsb2NrZWRBbmltYXRpb25zW2FuaW1JZF0gb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJwdW5jaCIpIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1OYW1lOm1hdGNoKCJyaWdodCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrOlN0b3AoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQpCgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5Ub29sQ29ubmVjdGlvbnMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBfRy5Ub29sQ29ubmVjdGlvbnMgPSB7fQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIF9HLlRvb2xDb25uZWN0aW9uc1t0b29sXSA9IGNvbm5lY3Rpb24KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgZm9yIF8sIHRvb2wgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgICAgIHByb2Nlc3NUb29sKHRvb2wpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgaWYgY2hhciB0aGVuCiAgICAgICAgICAgIGZvciBfLCB0b29sIGluIHBhaXJzKGNoYXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICAgICAgICAgIGlmIHRvb2w6SXNBKCJUb29sIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKHRvb2wpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgICAgIF9HLkJhY2twYWNrQWRkZWRDb25uZWN0aW9uID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkKICAgICAgICAgICAgICAgIGlmIGNoaWxkOklzQSgiVG9vbCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb29sKGNoaWxkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gYW5kIGNoYXIgdGhlbgogICAgICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uID0gY2hhci5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgICAgICBpZiBjaGlsZDpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9vbChjaGlsZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBvdmVycmlkZVRvb2xBY3RpdmF0aW9uKCkKCiAgICBpZiBub3QgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BbmltTW9uaXRvckNvbm5lY3Rpb24gPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5IZWFydGJlYXQ6Q29ubmVjdChmdW5jdGlvbigpCiAgICAgICAgICAgIGlmIHRpY2soKSAlIDAuNSA8IDAuMDEgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICAgICAgICAgIGZvciBfLCB0cmFjayBpbiBwYWlycyhjaGFyLkh1bWFub2lkOkdldFBsYXlpbmdBbmltYXRpb25UcmFja3MoKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdHJhY2suQW5pbWF0aW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1JZCA9IHRyYWNrLkFuaW1hdGlvbi5BbmltYXRpb25JZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYW5pbU5hbWUgPSB0cmFjay5OYW1lOmxvd2VyKCkKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBibG9ja2VkQW5pbWF0aW9uc1thbmltSWRdIG9yCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbU5hbWU6bWF0Y2goInB1bmNoIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgiYXR0YWNrIikgb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltTmFtZTptYXRjaCgicmlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2s6U3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZW5kCgogICAgaWYgbm90IF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24obmV3Q2hhcikKICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgICAgIHNldHVwQW5pbWF0aW9uQmxvY2tpbmcoKQogICAgICAgICAgICBvdmVycmlkZVRvb2xBY3RpdmF0aW9uKCkKCiAgICAgICAgICAgIGlmIF9HLkNoYXJhY3RlclRvb2xBZGRlZENvbm5lY3Rpb24gdGhlbgogICAgICAgICAgICAgICAgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uID0gbmV3Q2hhci5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oY2hpbGQpCiAgICAgICAgICAgICAgICBpZiBjaGlsZDpJc0EoIlRvb2wiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMSkKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9vbChjaGlsZCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZW5kKQogICAgZW5kCmVuZCkKCmZ1bmN0aW9uIFJlY292ZXJ5UHVuY2goKQogICAgaWYgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQW5pbUJsb2NrQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5BbmltQmxvY2tDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQW5pbU1vbml0b3JDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkFuaW1Nb25pdG9yQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5Ub29sQ29ubmVjdGlvbnMgdGhlbgogICAgICAgIGZvciBfLCBjb25uIGluIHBhaXJzKF9HLlRvb2xDb25uZWN0aW9ucykgZG8KICAgICAgICAgICAgaWYgY29ubiB0aGVuIGNvbm46RGlzY29ubmVjdCgpIGVuZAogICAgICAgIGVuZAogICAgICAgIF9HLlRvb2xDb25uZWN0aW9ucyA9IG5pbAogICAgZW5kCiAgICBpZiBfRy5CYWNrcGFja0FkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgX0cuQmFja3BhY2tBZGRlZENvbm5lY3Rpb24gPSBuaWwKICAgIGVuZAogICAgaWYgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQ2hhcmFjdGVyVG9vbEFkZGVkQ29ubmVjdGlvbjpEaXNjb25uZWN0KCkKICAgICAgICBfRy5DaGFyYWN0ZXJUb29sQWRkZWRDb25uZWN0aW9uID0gbmlsCiAgICBlbmQKICAgIGlmIF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbiB0aGVuCiAgICAgICAgX0cuQ2hhcmFjdGVyQWRkZWRDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgICAgIF9HLkNoYXJhY3RlckFkZGVkQ29ubmVjdGlvbiA9IG5pbAogICAgZW5kCmVuZAoKS2lsbGVyOkFkZEJ1dHRvbigiUmVjb3ZlciBQdW5jaCBBbmltIiwgZnVuY3Rpb24oKQogICAgUmVjb3ZlcnlQdW5jaCgpCmVuZCkKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgZnJpZW5kV2hpdGVsaXN0QWN0aXZlID0gZmFsc2UKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gV2hpdGVsaXN0IEZyaWVuZHMgKEZhc3QgRnVuY3Rpb24pICIsIGZ1bmN0aW9uKHN0YXRlKQogICAgZnJpZW5kV2hpdGVsaXN0QWN0aXZlID0gc3RhdGUKCiAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgZm9yIF8sIHBsYXllciBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgTG9jYWxQbGF5ZXI6SXNGcmllbmRzV2l0aChwbGF5ZXIuVXNlcklkKSB0aGVuCiAgICAgICAgICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgICAgICAgICAgaWYgZnJpZW5kV2hpdGVsaXN0QWN0aXZlIGFuZCBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgYW5kIExvY2FsUGxheWVyOklzRnJpZW5kc1dpdGgocGxheWVyLlVzZXJJZCkgdGhlbgogICAgICAgICAgICAgICAgcGxheWVyV2hpdGVsaXN0W3BsYXllci5OYW1lXSA9IHRydWUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIGZvciBuYW1lIGluIHBhaXJzKHBsYXllcldoaXRlbGlzdCkgZG8KICAgICAgICAgICAgbG9jYWwgZnJpZW5kID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChuYW1lKQogICAgICAgICAgICBpZiBmcmllbmQgYW5kIExvY2FsUGxheWVyOklzRnJpZW5kc1dpdGgoZnJpZW5kLlVzZXJJZCkgdGhlbgogICAgICAgICAgICAgICAgcGxheWVyV2hpdGVsaXN0W25hbWVdID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRUZXh0Qm94KCJXaGl0ZWxpc3QiLCBmdW5jdGlvbih0ZXh0KQogICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZCh0ZXh0KQogICAgaWYgdGFyZ2V0IHRoZW4KICAgICAgICBwbGF5ZXJXaGl0ZWxpc3RbdGFyZ2V0Lk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZCkKCktpbGxlcjpBZGRUZXh0Qm94KCJVbldoaXRlbGlzdCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCB0YXJnZXQgPSBQbGF5ZXJzOkZpbmRGaXJzdENoaWxkKHRleHQpCiAgICBpZiB0YXJnZXQgdGhlbgogICAgICAgIHBsYXllcldoaXRlbGlzdFt0YXJnZXQuTmFtZV0gPSBuaWwKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIEtpbGwiLCBmdW5jdGlvbihib29sKQogICAgYXV0b0tpbGwgPSBib29sCgogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgYXV0b0tpbGwgZG8KICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIG9yIExvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpCgogICAgICAgICAgICBsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgIGlmIHB1bmNoIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4KICAgICAgICAgICAgICAgIHB1bmNoLlBhcmVudCA9IGNoYXJhY3RlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGlmIHJpZ2h0SGFuZCBhbmQgbGVmdEhhbmQgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHRhcmdldCBpbiBpcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0IH49IExvY2FsUGxheWVyIGFuZCBub3QgcGxheWVyV2hpdGVsaXN0W3RhcmdldC5OYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHRhcmdldENoYXIgPSB0YXJnZXQuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gdGFyZ2V0Q2hhciBhbmQgdGFyZ2V0Q2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJvb3RQYXJ0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChyaWdodEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KGxlZnRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB0YXNrLndhaXQoMC4wNSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgdGFyZ2V0RHJvcGRvd24gPSBLaWxsZXI6QWRkRHJvcGRvd24oIlNlbGVjdCBUYXJnZXQiLCBmdW5jdGlvbihuYW1lKQogICAgaWYgbmFtZSBhbmQgbm90IHRhYmxlLmZpbmQodGFyZ2V0UGxheWVyTmFtZXMsIG5hbWUpIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQodGFyZ2V0UGxheWVyTmFtZXMsIG5hbWUpCiAgICBlbmQKZW5kKQoKS2lsbGVyOkFkZFRleHRCb3goIlJlbW92ZSBUYXJnZXQiLCBmdW5jdGlvbihuYW1lKQogICAgZm9yIGksIHYgaW4gaXBhaXJzKHRhcmdldFBsYXllck5hbWVzKSBkbwogICAgICAgIGlmIHYgPT0gbmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh0YXJnZXRQbGF5ZXJOYW1lcywgaSkKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgICAgIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKHBsYXllci5OYW1lKQogICAgICAgIHRhcmdldERyb3Bkb3duSXRlbXNbcGxheWVyLk5hbWVdID0gdHJ1ZQogICAgZW5kCmVuZCkKClBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpCiAgICBpZiB0YXJnZXREcm9wZG93bkl0ZW1zW3BsYXllci5OYW1lXSB0aGVuCiAgICAgICAgdGFyZ2V0RHJvcGRvd25JdGVtc1twbGF5ZXIuTmFtZV0gPSBuaWwKICAgICAgICB0YXJnZXREcm9wZG93bjpDbGVhcigpCiAgICAgICAgZm9yIG5hbWUgaW4gcGFpcnModGFyZ2V0RHJvcGRvd25JdGVtcykgZG8KICAgICAgICAgICAgdGFyZ2V0RHJvcGRvd246QWRkKG5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgaSA9ICN0YXJnZXRQbGF5ZXJOYW1lcywgMSwgLTEgZG8KICAgICAgICBpZiB0YXJnZXRQbGF5ZXJOYW1lc1tpXSA9PSBwbGF5ZXIuTmFtZSB0aGVuCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZSh0YXJnZXRQbGF5ZXJOYW1lcywgaSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJTdGFydCBLaWxsIFRhcmdldCIsIGZ1bmN0aW9uKHN0YXRlKQogICAga2lsbFRhcmdldCA9IHN0YXRlCgogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUga2lsbFRhcmdldCBkbwogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIgb3IgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgogICAgICAgICAgICBsb2NhbCBwdW5jaCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpCiAgICAgICAgICAgIGlmIHB1bmNoIGFuZCBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJQdW5jaCIpIHRoZW4KICAgICAgICAgICAgICAgIHB1bmNoLlBhcmVudCA9IGNoYXJhY3RlcgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IGNoYXJhY3RlcjpXYWl0Rm9yQ2hpbGQoIlJpZ2h0SGFuZCIsIDUpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiTGVmdEhhbmQiLCA1KQoKICAgICAgICAgICAgaWYgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgbmFtZSBpbiBpcGFpcnModGFyZ2V0UGxheWVyTmFtZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gUGxheWVyczpGaW5kRmlyc3RDaGlsZChuYW1lKQogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCBhbmQgdGFyZ2V0IH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm9vdFBhcnQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjA1KQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpsb2NhbCBzcHlUYXJnZXREcm9wZG93biA9IEtpbGxlcjpBZGREcm9wZG93bigiU2VsZWN0IFZpZXcgVGFyZ2V0IiwgZnVuY3Rpb24obmFtZSkKICAgIHRhcmdldFBsYXllck5hbWUgPSBuYW1lCmVuZCkKCmZvciBfLCBwbGF5ZXIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICBzcHlUYXJnZXREcm9wZG93bjpBZGQocGxheWVyLk5hbWUpCiAgICBlbmQKZW5kCgpQbGF5ZXJzLlBsYXllckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24ocGxheWVyKQogICAgaWYgcGxheWVyIH49IExvY2FsUGxheWVyIHRoZW4KICAgICAgICBzcHlUYXJnZXREcm9wZG93bjpBZGQocGxheWVyLk5hbWUpCiAgICBlbmQKZW5kKQoKUGxheWVycy5QbGF5ZXJSZW1vdmluZzpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikKICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246Q2xlYXIoKQogICAgICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICBpZiBwbHIgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgc3B5VGFyZ2V0RHJvcGRvd246QWRkKHBsci5OYW1lKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJWaWV3IFBsYXllciIsIGZ1bmN0aW9uKGJvb2wpCiAgICBzcHlpbmcgPSBib29sCiAgICBpZiBub3Qgc3B5aW5nIHRoZW4KICAgICAgICBsb2NhbCBjYW0gPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYQogICAgICAgIGNhbS5DYW1lcmFTdWJqZWN0ID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyIGFuZCBMb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgb3IgTG9jYWxQbGF5ZXIKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgc3B5aW5nIGRvCiAgICAgICAgICAgIGxvY2FsIHRhcmdldCA9IFBsYXllcnM6RmluZEZpcnN0Q2hpbGQodGFyZ2V0UGxheWVyTmFtZSkKICAgICAgICAgICAgaWYgdGFyZ2V0IGFuZCB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSB0YXJnZXQuQ2hhcmFjdGVyIGFuZCB0YXJnZXQuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpCiAgICAgICAgICAgICAgICBpZiBodW1hbm9pZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgd29ya3NwYWNlLkN1cnJlbnRDYW1lcmEuQ2FtZXJhU3ViamVjdCA9IGh1bWFub2lkCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCktpbGxlcjpBZGRTd2l0Y2goIkF1dG8gR29vZCBLYXJtYSIsIGZ1bmN0aW9uKGJvb2wpCiAgICBhdXRvR29vZEthcm1hID0gYm9vbAogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgYXV0b0dvb2RLYXJtYSBkbwogICAgICAgICAgICBsb2NhbCBwbGF5ZXJDaGFyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgIGxvY2FsIHJpZ2h0SGFuZCA9IHBsYXllckNoYXIgYW5kIHBsYXllckNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpCiAgICAgICAgICAgIGxvY2FsIGxlZnRIYW5kID0gcGxheWVyQ2hhciBhbmQgcGxheWVyQ2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKQogICAgICAgICAgICBpZiBwbGF5ZXJDaGFyIGFuZCByaWdodEhhbmQgYW5kIGxlZnRIYW5kIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCB0YXJnZXQgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHRhcmdldCB+PSBMb2NhbFBsYXllciB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGV2aWxLYXJtYSA9IHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiZXZpbEthcm1hIikKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZ29vZEthcm1hID0gdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJnb29kS2FybWEiKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBldmlsS2FybWEgYW5kIGdvb2RLYXJtYSBhbmQgZXZpbEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZ29vZEthcm1hOklzQSgiSW50VmFsdWUiKSBhbmQgZXZpbEthcm1hLlZhbHVlID4gZ29vZEthcm1hLlZhbHVlIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gdGFyZ2V0LkNoYXJhY3RlciBhbmQgdGFyZ2V0LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByb290UGFydCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QocmlnaHRIYW5kLCByb290UGFydCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdChsZWZ0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxKQogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgpLaWxsZXI6QWRkU3dpdGNoKCJBdXRvIEJhZCBLYXJtYSAoRmFzdCBBdXRvIEtpbGwpICIsIGZ1bmN0aW9uKGJvb2wpCiAgICBhdXRvQmFkS2FybWEgPSBib29sCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBhdXRvQmFkS2FybWEgZG8KICAgICAgICAgICAgbG9jYWwgcGxheWVyQ2hhciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICBsb2NhbCByaWdodEhhbmQgPSBwbGF5ZXJDaGFyIGFuZCBwbGF5ZXJDaGFyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKQogICAgICAgICAgICBsb2NhbCBsZWZ0SGFuZCA9IHBsYXllckNoYXIgYW5kIHBsYXllckNoYXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikKICAgICAgICAgICAgaWYgcGxheWVyQ2hhciBhbmQgcmlnaHRIYW5kIGFuZCBsZWZ0SGFuZCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdGFyZ2V0IGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB0YXJnZXQgfj0gTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBldmlsS2FybWEgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQoImV2aWxLYXJtYSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGdvb2RLYXJtYSA9IHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiZ29vZEthcm1hIikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXZpbEthcm1hIGFuZCBnb29kS2FybWEgYW5kIGV2aWxLYXJtYTpJc0EoIkludFZhbHVlIikgYW5kIGdvb2RLYXJtYTpJc0EoIkludFZhbHVlIikgYW5kIGdvb2RLYXJtYS5WYWx1ZSA+IGV2aWxLYXJtYS5WYWx1ZSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCByb290UGFydCA9IHRhcmdldC5DaGFyYWN0ZXIgYW5kIHRhcmdldC5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcm9vdFBhcnQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHJpZ2h0SGFuZCwgcm9vdFBhcnQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3QobGVmdEhhbmQsIHJvb3RQYXJ0LCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YXNrLndhaXQoMC4wMSkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgYXV0b1JvY2tGb2xkZXIgPSB0YWIzOkFkZEZvbGRlcigiQXV0byBSb2NrIikKCmZ1bmN0aW9uIGdldHRvb2woKQogICAgZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgdi5OYW1lID09ICJQdW5jaCIgYW5kIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbgogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbCh2KQogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcgogICAgcGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgImxlZnRIYW5kIikKICAgIHBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJyaWdodEhhbmQiKQplbmQKCmF1dG9Sb2NrRm9sZGVyOkFkZFN3aXRjaCgiVGlueSBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIlRpbnkgSXNsYW5kIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAwMDUpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrRm9sZGVyOkFkZFN3aXRjaCgiU3RhcnRlciBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIlN0YXJ0ZXIgSXNsYW5kIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAwMDUpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMTAwIHRoZW4KICAgICAgICAgICAgICAgIGZvciBfLCB2IGluIHBhaXJzKHdvcmtzcGFjZS5tYWNoaW5lc0ZvbGRlcjpHZXREZXNjZW5kYW50cygpKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIHYuTmFtZSA9PSAibmVlZGVkRHVyYWJpbGl0eSIgYW5kIHYuVmFsdWUgPT0gMTAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja0ZvbGRlcjpBZGRTd2l0Y2goIkxlZ2VuZCBCZWFjaCBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkxlZ2VuZCBCZWFjaCBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoMC4wMDA1KQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDUwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA1MDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja0ZvbGRlcjpBZGRTd2l0Y2goIkZyb3plbiBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkZyb3N0IEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoMC4wMDA1KQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDE1MDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDE1MDAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tGb2xkZXI6QWRkU3dpdGNoKCJNeXRoaWNhbCBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIk15dGhpY2FsIEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoMC4wMDA1KQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDQwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh3b3Jrc3BhY2UubWFjaGluZXNGb2xkZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8KICAgICAgICAgICAgICAgICAgICBpZiB2Lk5hbWUgPT0gIm5lZWRlZER1cmFiaWxpdHkiIGFuZCB2LlZhbHVlID09IDQwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKYXV0b1JvY2tGb2xkZXI6QWRkU3dpdGNoKCJFdGVybmFsIFJvY2siLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiRXRlcm5hbCBHeW0gUm9jayIKICAgIGdldGdlbnYoKS5hdXRvRmFybSA9IFZhbHVlCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSBnZXRnZW52KCkuYXV0b0Zhcm0gZG8KICAgICAgICAgICAgdGFzay53YWl0KDAuMDAwNSkKICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5hdXRvRmFybSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICBpZiBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSA+PSA3NTAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA3NTAwMDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBjaGFyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGFyIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJMZWZ0SGFuZCIpIGFuZCBjaGFyOkZpbmRGaXJzdENoaWxkKCJSaWdodEhhbmQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLlJpZ2h0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuUmlnaHRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5MZWZ0SGFuZCwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuTGVmdEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXR0b29sKCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZCkKCmF1dG9Sb2NrRm9sZGVyOkFkZFN3aXRjaCgiTGVnZW5kIFJvY2siLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiTGVnZW5kIEd5bSBSb2NrIgogICAgZ2V0Z2VudigpLmF1dG9GYXJtID0gVmFsdWUKICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5hdXRvRmFybSBkbwogICAgICAgICAgICB0YXNrLndhaXQoMC4wMDA1KQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDEwMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxMDAwMDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja0ZvbGRlcjpBZGRTd2l0Y2goIk11c2NsZSBLaW5nIFJvY2siLCBmdW5jdGlvbihWYWx1ZSkKICAgIHNlbGVjdHJvY2sgPSAiTXVzY2xlIEtpbmcgR3ltIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLmF1dG9GYXJtIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5EdXJhYmlsaXR5LlZhbHVlID49IDUwMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSA1MDAwMDAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2hhciBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiTGVmdEhhbmQiKSBhbmQgY2hhcjpGaW5kRmlyc3RDaGlsZCgiUmlnaHRIYW5kIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5SaWdodEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLlJpZ2h0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuTGVmdEhhbmQsIDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLkxlZnRIYW5kLCAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0dG9vbCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQplbmQpCgphdXRvUm9ja0ZvbGRlcjpBZGRTd2l0Y2goIkp1bmdsZSBSb2NrIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBzZWxlY3Ryb2NrID0gIkFuY2llbnQgSnVuZ2xlIFJvY2siCiAgICBnZXRnZW52KCkuYXV0b0Zhcm0gPSBWYWx1ZQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLmF1dG9GYXJtIGRvCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAwMDUpCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuYXV0b0Zhcm0gdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkR1cmFiaWxpdHkuVmFsdWUgPj0gMTAwMDAwMDAgdGhlbgogICAgICAgICAgICAgICAgZm9yIF8sIHYgaW4gcGFpcnMod29ya3NwYWNlLm1hY2hpbmVzRm9sZGVyOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgdi5OYW1lID09ICJuZWVkZWREdXJhYmlsaXR5IiBhbmQgdi5WYWx1ZSA9PSAxMDAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoYXIgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIkxlZnRIYW5kIikgYW5kIGNoYXI6RmluZEZpcnN0Q2hpbGQoIlJpZ2h0SGFuZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmV0b3VjaGludGVyZXN0KHYuUGFyZW50LlJvY2ssIGNoYXIuUmlnaHRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5SaWdodEhhbmQsIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJldG91Y2hpbnRlcmVzdCh2LlBhcmVudC5Sb2NrLCBjaGFyLkxlZnRIYW5kLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXRvdWNoaW50ZXJlc3Qodi5QYXJlbnQuUm9jaywgY2hhci5MZWZ0SGFuZCwgMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldHRvb2woKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kKQoKbG9jYWwgYXV0b0VxdWlwVG9vbHNGb2xkZXIgPSB0YWIzOkFkZEZvbGRlcigiQXV0byBUb29scyIpCgphdXRvRXF1aXBUb29sc0ZvbGRlcjpBZGRCdXR0b24oIkdhbWVwYXNzIEF1dG9MaWZ0IiwgZnVuY3Rpb24oKQogICAgbG9jYWwgZ2FtZXBhc3NGb2xkZXIgPSBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuZ2FtZXBhc3NJZHMKICAgIGxvY2FsIHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyCiAgICBmb3IgXywgZ2FtZXBhc3MgaW4gcGFpcnMoZ2FtZXBhc3NGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8KICAgICAgICBsb2NhbCB2YWx1ZSA9IEluc3RhbmNlLm5ldygiSW50VmFsdWUiKQogICAgICAgIHZhbHVlLk5hbWUgPSBnYW1lcGFzcy5OYW1lCiAgICAgICAgdmFsdWUuVmFsdWUgPSBnYW1lcGFzcy5WYWx1ZQogICAgICAgIHZhbHVlLlBhcmVudCA9IHBsYXllci5vd25lZEdhbWVwYXNzZXMKICAgIGVuZAplbmQpCgpsb2NhbCBmdW5jdGlvbiBjcmVhdGVBdXRvVG9vbFN3aXRjaCh0b29sTmFtZSwgZ2xvYmFsVmFyKQogICAgYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJBdXRvICIgLi4gdG9vbE5hbWUsIGZ1bmN0aW9uKFZhbHVlKQogICAgICAgIF9HW2dsb2JhbFZhcl0gPSBWYWx1ZQogICAgICAgIAogICAgICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICAgICAgbG9jYWwgdG9vbCA9IExvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xOYW1lKQogICAgICAgICAgICBpZiB0b29sIHRoZW4KICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2wodG9vbCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBsb2NhbCBjaGFyYWN0ZXIgPSBMb2NhbFBsYXllci5DaGFyYWN0ZXIKICAgICAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQodG9vbE5hbWUpCiAgICAgICAgICAgIGlmIGVxdWlwcGVkIHRoZW4KICAgICAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IExvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBfR1tnbG9iYWxWYXJdIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgX0dbZ2xvYmFsVmFyXSB0aGVuIGJyZWFrIGVuZAogICAgICAgICAgICAgICAgTG9jYWxQbGF5ZXIubXVzY2xlRXZlbnQ6RmlyZVNlcnZlcigicmVwIikKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZCkKZW5kCgpjcmVhdGVBdXRvVG9vbFN3aXRjaCgiV2VpZ2h0IiwgIkF1dG9XZWlnaHQiKQpjcmVhdGVBdXRvVG9vbFN3aXRjaCgiUHVzaHVwcyIsICJBdXRvUHVzaHVwcyIpCmNyZWF0ZUF1dG9Ub29sU3dpdGNoKCJIYW5kc3RhbmRzIiwgIkF1dG9IYW5kc3RhbmRzIikKY3JlYXRlQXV0b1Rvb2xTd2l0Y2goIlNpdHVwcyIsICJBdXRvU2l0dXBzIikKCmF1dG9FcXVpcFRvb2xzRm9sZGVyOkFkZFN3aXRjaCgiQXV0byBQdW5jaCIsIGZ1bmN0aW9uKFZhbHVlKQogICAgX0cuZmFzdEhpdEFjdGl2ZSA9IFZhbHVlCiAgICAKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgX0cuZmFzdEhpdEFjdGl2ZSBkbwogICAgICAgICAgICAgICAgaWYgbm90IF9HLmZhc3RIaXRBY3RpdmUgdGhlbiBicmVhayBlbmQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgcHVuY2ggPSBMb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUHVuY2giKQogICAgICAgICAgICAgICAgaWYgcHVuY2ggdGhlbgogICAgICAgICAgICAgICAgICAgIHB1bmNoLlBhcmVudCA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgICAgIGlmIHB1bmNoOkZpbmRGaXJzdENoaWxkKCJhdHRhY2tUaW1lIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwdW5jaC5hdHRhY2tUaW1lLlZhbHVlID0gMAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIF9HLmZhc3RIaXRBY3RpdmUgZG8KICAgICAgICAgICAgICAgIGlmIG5vdCBfRy5mYXN0SGl0QWN0aXZlIHRoZW4gYnJlYWsgZW5kCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIExvY2FsUGxheWVyLm11c2NsZUV2ZW50OkZpcmVTZXJ2ZXIoInB1bmNoIiwgInJpZ2h0SGFuZCIpCiAgICAgICAgICAgICAgICBMb2NhbFBsYXllci5tdXNjbGVFdmVudDpGaXJlU2VydmVyKCJwdW5jaCIsICJsZWZ0SGFuZCIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxvY2FsIGNoYXJhY3RlciA9IExvY2FsUGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgY2hhcmFjdGVyIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBwdW5jaFRvb2wgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICAgICAgICAgICAgICBpZiBwdW5jaFRvb2wgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBwdW5jaFRvb2w6QWN0aXZhdGUoKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyCiAgICAgICAgbG9jYWwgZXF1aXBwZWQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIlB1bmNoIikKICAgICAgICBpZiBlcXVpcHBlZCB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkLlBhcmVudCA9IExvY2FsUGxheWVyLkJhY2twYWNrCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKYXV0b0VxdWlwVG9vbHNGb2xkZXI6QWRkU3dpdGNoKCJGYXN0IFRvb2xzIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5GYXN0VG9vbHMgPSBWYWx1ZQogICAgCiAgICBsb2NhbCB0b29sU2V0dGluZ3MgPSB7CiAgICAgICAgeyJQdW5jaCIsICJhdHRhY2tUaW1lIiwgVmFsdWUgYW5kIDAgb3IgMC4zNX0sCiAgICAgICAgeyJHcm91bmQgU2xhbSIsICJhdHRhY2tUaW1lIiwgVmFsdWUgYW5kIDAgb3IgNn0sCiAgICAgICAgeyJTdG9tcCIsICJhdHRhY2tUaW1lIiwgVmFsdWUgYW5kIDAgb3IgN30sCiAgICAgICAgeyJIYW5kc3RhbmRzIiwgInJlcFRpbWUiLCBWYWx1ZSBhbmQgMCBvciAxfSwKICAgICAgICB7IlB1c2h1cHMiLCAicmVwVGltZSIsIFZhbHVlIGFuZCAwIG9yIDF9LAogICAgICAgIHsiV2VpZ2h0IiwgInJlcFRpbWUiLCBWYWx1ZSBhbmQgMCBvciAxfSwKICAgICAgICB7IlNpdHVwcyIsICJyZXBUaW1lIiwgVmFsdWUgYW5kIDAgb3IgMX0KICAgIH0KICAgIAogICAgbG9jYWwgYmFja3BhY2sgPSBMb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIikKICAgIAogICAgZm9yIF8sIHRvb2xJbmZvIGluIGlwYWlycyh0b29sU2V0dGluZ3MpIGRvCiAgICAgICAgbG9jYWwgdG9vbCA9IGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzFdKQogICAgICAgIGlmIHRvb2wgYW5kIHRvb2w6RmluZEZpcnN0Q2hpbGQodG9vbEluZm9bMl0pIHRoZW4KICAgICAgICAgICAgdG9vbFt0b29sSW5mb1syXV0uVmFsdWUgPSB0b29sSW5mb1szXQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGVxdWlwcGVkVG9vbCA9IExvY2FsUGxheWVyLkNoYXJhY3RlciBhbmQgTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzFdKQogICAgICAgIGlmIGVxdWlwcGVkVG9vbCBhbmQgZXF1aXBwZWRUb29sOkZpbmRGaXJzdENoaWxkKHRvb2xJbmZvWzJdKSB0aGVuCiAgICAgICAgICAgIGVxdWlwcGVkVG9vbFt0b29sSW5mb1syXV0uVmFsdWUgPSB0b29sSW5mb1szXQogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIFJlYmlydGggPSB0YWIzOkFkZEZvbGRlcigiQXV0byBSZWJpcnRocyIpCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBwbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpCgotLSBIZWxwZXI6IEVxdWlwIFdlaWdodApsb2NhbCBmdW5jdGlvbiBlcXVpcFdlaWdodCgpCiAgICBsb2NhbCBjaGFyYWN0ZXIgPSBwbGF5ZXIuQ2hhcmFjdGVyCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgbG9jYWwgZXF1aXBwZWRXZWlnaHQgPSBjaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIldlaWdodCIpCiAgICBpZiBlcXVpcHBlZFdlaWdodCB0aGVuIHJldHVybiB0cnVlIGVuZAogICAgbG9jYWwgd2VpZ2h0VG9vbCA9IHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiV2VpZ2h0IikKICAgIGlmIG5vdCB3ZWlnaHRUb29sIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgd2VpZ2h0VG9vbC5QYXJlbnQgPSBjaGFyYWN0ZXIKICAgIHRhc2sud2FpdCgwLjEpCiAgICByZXR1cm4gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKSB+PSBuaWwKZW5kCgotLSBCYXNpYyBBdXRvIExpZnQgJiBFcXVpcApsb2NhbCBhdXRvTGlmdFRvZ2dsZSA9IGZhbHNlClJlYmlydGg6QWRkU3dpdGNoKCJBdXRvIExpZnQgJiBFcXVpcCIsIGZ1bmN0aW9uKFN0YXRlKQogICAgYXV0b0xpZnRUb2dnbGUgPSBTdGF0ZQogICAgaWYgU3RhdGUgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBhdXRvTGlmdFRvZ2dsZSBkbwogICAgICAgICAgICAgICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlcgogICAgICAgICAgICAgICAgaWYgbm90IGNoYXJhY3RlciB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBub3QgY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJXZWlnaHQiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZXF1aXBXZWlnaHQoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBsb2NhbCBtdXNjbGVFdmVudCA9IHBsYXllcjpGaW5kRmlyc3RDaGlsZCgibXVzY2xlRXZlbnQiKSBvciBwbGF5ZXI6V2FpdEZvckNoaWxkKCJtdXNjbGVFdmVudCIsIDUpCiAgICAgICAgICAgICAgICBpZiBtdXNjbGVFdmVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSBtdXNjbGVFdmVudDpGaXJlU2VydmVyKCJyZXAiKSBlbmQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQpCgotLSBBdXRvIFJlYmlydGggKGluZmluaXRlKQpsb2NhbCBhdXRvUmViaXJ0aCA9IGZhbHNlClJlYmlydGg6QWRkU3dpdGNoKCJBdXRvIFJlYmlydGggKGluZmluaXRlKSIsIGZ1bmN0aW9uKHN0YXRlKQogICAgYXV0b1JlYmlydGggPSBzdGF0ZQogICAgaWYgc3RhdGUgdGhlbgogICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBhdXRvUmViaXJ0aCBkbwogICAgICAgICAgICAgICAgbG9jYWwgcmVtb3RlID0gUmVwbGljYXRlZFN0b3JhZ2U6V2FpdEZvckNoaWxkKCJyRXZlbnRzIik6V2FpdEZvckNoaWxkKCJyZWJpcnRoUmVtb3RlIikKICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICByZW1vdGU6SW52b2tlU2VydmVyKCJyZWJpcnRoUmVxdWVzdCIpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC4xKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kKQoKLS0gQXV0byBSZWJpcnRoIHRvIFRhcmdldApsb2NhbCBSQiA9IHt9ClJCLl9faW5kZXggPSBSQgoKZnVuY3Rpb24gUkIubmV3KHRhYikKICAgIGxvY2FsIHNlbGYgPSBzZXRtZXRhdGFibGUoe30sIFJCKQogICAgc2VsZi5vbiA9IGZhbHNlCiAgICBzZWxmLnRhcmdldCA9IDEKICAgIHNlbGYudGFiID0gdGFiCiAgICBzZWxmOnVpKCkKICAgIHJldHVybiBzZWxmCmVuZAoKZnVuY3Rpb24gUkI6dWkoKQogICAgc2VsZi5pbnB1dCA9IHNlbGYudGFiOkFkZFRleHRCb3goIlRhcmdldCIsIGZ1bmN0aW9uKHYpCiAgICAgICAgbG9jYWwgbiA9IHRvbnVtYmVyKHYpCiAgICAgICAgaWYgbiBhbmQgbiA+PSAxIHRoZW4KICAgICAgICAgICAgc2VsZi50YXJnZXQgPSBuCiAgICAgICAgZWxzZQogICAgICAgICAgICBzZWxmLmlucHV0OlNldCgiIikKICAgICAgICBlbmQKICAgIGVuZCwgeyBwbGFjZWhvbGRlciA9ICJFbnRlciB0YXJnZXQgcmViaXJ0aHMiIH0pCgogICAgc2VsZi50YWI6QWRkU3dpdGNoKCJBdXRvIFJlYmlydGgoVGFyZ2V0KSIsIGZ1bmN0aW9uKHMpCiAgICAgICAgc2VsZi5vbiA9IHMKICAgICAgICBpZiBzIHRoZW4KICAgICAgICAgICAgc2VsZjpydW4oKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCmZ1bmN0aW9uIFJCOnJ1bigpCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBsZWFkZXJzdGF0cyA9IHBsYXllcjpXYWl0Rm9yQ2hpbGQoImxlYWRlcnN0YXRzIikKICAgICAgICBsb2NhbCByZWJpcnRocyA9IGxlYWRlcnN0YXRzIGFuZCBsZWFkZXJzdGF0czpXYWl0Rm9yQ2hpbGQoIlJlYmlydGhzIikKICAgICAgICBsb2NhbCBldmVudHMgPSBSZXBsaWNhdGVkU3RvcmFnZTpXYWl0Rm9yQ2hpbGQoInJFdmVudHMiKQogICAgICAgIGxvY2FsIHJlbW90ZSA9IGV2ZW50cyBhbmQgZXZlbnRzOldhaXRGb3JDaGlsZCgicmViaXJ0aFJlbW90ZSIpCgogICAgICAgIGlmIG5vdCAocmViaXJ0aHMgYW5kIHJlbW90ZSkgdGhlbgogICAgICAgICAgICBzZWxmLm9uID0gZmFsc2UKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIHdoaWxlIHNlbGYub24gZG8KICAgICAgICAgICAgaWYgcmViaXJ0aHMuVmFsdWUgPj0gc2VsZi50YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgc2VsZi5vbiA9IGZhbHNlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHJlbW90ZTpJbnZva2VTZXJ2ZXIoInJlYmlydGhSZXF1ZXN0IikKICAgICAgICAgICAgZW5kKQoKICAgICAgICAgICAgdGFzay53YWl0KDEpCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZAoKbG9jYWwgbXlSZWJpcnRoID0gUkIubmV3KFJlYmlydGgpCgotLSBBdXRvIFNpemUgMgpsb2NhbCBhdXRvU2l6ZUxvb3AgPSBuaWwKUmViaXJ0aDpBZGRTd2l0Y2goIkF1dG8gU2l6ZSAyIiwgZnVuY3Rpb24oc3RhdGUpCiAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgYXV0b1NpemVMb29wID0gdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIHRhc2sud2FpdCgwLjEpIGRvCiAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5yRXZlbnRzLmNoYW5nZVNwZWVkU2l6ZVJlbW90ZTpJbnZva2VTZXJ2ZXIoImNoYW5nZVNpemUiLCAyKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbHNlCiAgICAgICAgaWYgYXV0b1NpemVMb29wIHRoZW4KICAgICAgICAgICAgdGFzay5jYW5jZWwoYXV0b1NpemVMb29wKQogICAgICAgICAgICBhdXRvU2l6ZUxvb3AgPSBuaWwKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSBIaWRlIEFsbCBGcmFtZXMKUmViaXJ0aDpBZGRTd2l0Y2goIkhpZGUgQWxsIEZyYW1lcyIsIGZ1bmN0aW9uKHN0YXRlKQogICAgbG9jYWwgclN0byA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQogICAgZm9yIF8sIG9iaiBpbiBwYWlycyhyU3RvOkdldENoaWxkcmVuKCkpIGRvCiAgICAgICAgaWYgb2JqLk5hbWU6bWF0Y2goIkZyYW1lJCIpIHRoZW4KICAgICAgICAgICAgb2JqLlZpc2libGUgPSBub3Qgc3RhdGUKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKbG9jYWwgbGVhZGVyc3RhdHMgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJsZWFkZXJzdGF0cyIpCmxvY2FsIHN0cmVuZ3RoU3RhdCA9IGxlYWRlcnN0YXRzOldhaXRGb3JDaGlsZCgiU3RyZW5ndGgiKQpsb2NhbCByZWJpcnRoc1N0YXQgPSBsZWFkZXJzdGF0czpXYWl0Rm9yQ2hpbGQoIlJlYmlydGhzIikKbG9jYWwgZHVyYWJpbGl0eVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJEdXJhYmlsaXR5IikKbG9jYWwga2lsbHNTdGF0ID0gbGVhZGVyc3RhdHM6V2FpdEZvckNoaWxkKCJLaWxscyIpCmxvY2FsIGFnaWxpdHlTdGF0ID0gcGxheWVyOldhaXRGb3JDaGlsZCgiQWdpbGl0eSIpCmxvY2FsIGV2aWxLYXJtYVN0YXQgPSBwbGF5ZXI6V2FpdEZvckNoaWxkKCJldmlsS2FybWEiKQpsb2NhbCBnb29kS2FybWFTdGF0ID0gcGxheWVyOldhaXRGb3JDaGlsZCgiZ29vZEthcm1hIikKbG9jYWwgYnJhd2xzU3RhdCA9IGxlYWRlcnN0YXRzOldhaXRGb3JDaGlsZCgiQnJhd2xzIikKCmxvY2FsIGZ1bmN0aW9uIEFiYnJldk51bWJlcihudW0pCiAgICBsb2NhbCBhYmJyZXYgPSB7IiIsICJLIiwgIk0iLCAiQiIsICJUIiwgIlFhIiwgIlFpIn0KICAgIGxvY2FsIGkgPSAxCiAgICB3aGlsZSBudW0gPj0gMTAwMCBhbmQgaSA8ICNhYmJyZXYgZG8KICAgICAgICBudW0gPSBudW0gLyAxMDAwCiAgICAgICAgaSA9IGkgKyAxCiAgICBlbmQKICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlLjJmJXMiLCBudW0sIGFiYnJldltpXSkKZW5kCgpzdGF0czpBZGRMYWJlbCgi4o+x77iPIFNlc3Npb24gU3RhdGlzdGljcyIpLlRleHRTaXplID0gMzAKbG9jYWwgc3RvcHdhdGNoTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiU2Vzc2lvbiBUaW1lOiAwZCAwaCAwbSAwcyIpCnN0b3B3YXRjaExhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIGN1c3RvbVRpbWVyTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiQ3VzdG9tIFRpbWVyOiBOb3Qgc3RhcnRlZCIpCmN1c3RvbVRpbWVyTGFiZWwuVGV4dFNpemUgPSAyMAoKbG9jYWwgaXNDdXN0b21SdW5uaW5nID0gZmFsc2UKbG9jYWwgY3VzdG9tU3RhcnQgPSAwCmxvY2FsIGN1c3RvbUVsYXBzZWQgPSAwCgpzdGF0czpBZGRCdXR0b24oIlN0YXJ0L1N0b3AgQ3VzdG9tIFRpbWVyIiwgZnVuY3Rpb24oKQogICAgaWYgbm90IGlzQ3VzdG9tUnVubmluZyB0aGVuCiAgICAgICAgaXNDdXN0b21SdW5uaW5nID0gdHJ1ZQogICAgICAgIGN1c3RvbVN0YXJ0ID0gdGljaygpIC0gY3VzdG9tRWxhcHNlZAogICAgZWxzZQogICAgICAgIGlzQ3VzdG9tUnVubmluZyA9IGZhbHNlCiAgICAgICAgY3VzdG9tRWxhcHNlZCA9IHRpY2soKSAtIGN1c3RvbVN0YXJ0CiAgICBlbmQKZW5kKQoKc3RhdHM6QWRkQnV0dG9uKCJSZXNldCBDdXN0b20gVGltZXIiLCBmdW5jdGlvbigpCiAgICBpc0N1c3RvbVJ1bm5pbmcgPSBmYWxzZQogICAgY3VzdG9tU3RhcnQgPSAwCiAgICBjdXN0b21FbGFwc2VkID0gMAogICAgY3VzdG9tVGltZXJMYWJlbC5UZXh0ID0gIkN1c3RvbSBUaW1lcjogTm90IHN0YXJ0ZWQiCmVuZCkKCmxvY2FsIHJlc2V0U2Vzc2lvbiA9IGZhbHNlCnN0YXRzOkFkZEJ1dHRvbigiUmVzZXQgU2Vzc2lvbiBTdGF0cyIsIGZ1bmN0aW9uKCkKICAgIHJlc2V0U2Vzc2lvbiA9IHRydWUKZW5kKQoKc3RhdHM6QWRkTGFiZWwoIi0tLS0tLS0tLS0tLS0tLS0tLSIpLlRleHRTaXplID0gMTQKCnN0YXRzOkFkZExhYmVsKCJQcm9qZWN0ZWQgU3RhdHMiKS5UZXh0U2l6ZSA9IDMwCmxvY2FsIHByb2plY3RlZFN0cmVuZ3RoTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiU3RyZW5ndGggUGFjZTogLSIpCnByb2plY3RlZFN0cmVuZ3RoTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBwcm9qZWN0ZWREdXJhYmlsaXR5TGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiRHVyYWJpbGl0eSBQYWNlOiAtIikKcHJvamVjdGVkRHVyYWJpbGl0eUxhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgcHJvamVjdGVkUmViaXJ0aHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJSZWJpcnRoIFBhY2U6IC0iKQpwcm9qZWN0ZWRSZWJpcnRoc0xhYmVsLlRleHRTaXplID0gMjAKCnN0YXRzOkFkZExhYmVsKCItLS0tLS0tLS0tLS0tLS0tLS0iKS5UZXh0U2l6ZSA9IDE0CgpzdGF0czpBZGRMYWJlbCgiTGVhZGVyYm9hcmQgU3RhdHMiKS5UZXh0U2l6ZSA9IDMwCmxvY2FsIHN0cmVuZ3RoTGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiU3RyZW5ndGg6IC0iKQpzdHJlbmd0aExhYmVsLlRleHRTaXplID0gMjAKbG9jYWwgcmViaXJ0aHNMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJSZWJpcnRoczogLSIpCnJlYmlydGhzTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBraWxsc0xhYmVsID0gc3RhdHM6QWRkTGFiZWwoIktpbGxzOiAtIikKa2lsbHNMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIGJyYXdsc0xhYmVsID0gc3RhdHM6QWRkTGFiZWwoIkJyYXdsczogLSIpCmJyYXdsc0xhYmVsLlRleHRTaXplID0gMjAKCnN0YXRzOkFkZExhYmVsKCItLS0tLS0tLS0tLS0tLS0tLS0iKS5UZXh0U2l6ZSA9IDE0CgpzdGF0czpBZGRMYWJlbCgiUGxheWVyIFN0YXRzIikuVGV4dFNpemUgPSAzMApsb2NhbCBnb29kS2FybWFMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJHb29kIEthcm1hOiAtIikKZ29vZEthcm1hTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBldmlsS2FybWFMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJFdmlsIEthcm1hOiAtIikKZXZpbEthcm1hTGFiZWwuVGV4dFNpemUgPSAyMApsb2NhbCBkdXJhYmlsaXR5TGFiZWwgPSBzdGF0czpBZGRMYWJlbCgiRHVyYWJpbGl0eTogLSIpCmR1cmFiaWxpdHlMYWJlbC5UZXh0U2l6ZSA9IDIwCmxvY2FsIGFnaWxpdHlMYWJlbCA9IHN0YXRzOkFkZExhYmVsKCJBZ2lsaXR5OiAtIikKYWdpbGl0eUxhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIHN0YXJ0VGltZSA9IHRpY2soKQpsb2NhbCBpbml0aWFsU3RyZW5ndGggPSBzdHJlbmd0aFN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbER1cmFiaWxpdHkgPSBkdXJhYmlsaXR5U3RhdC5WYWx1ZQpsb2NhbCBpbml0aWFsUmViaXJ0aHMgPSByZWJpcnRoc1N0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEtpbGxzID0ga2lsbHNTdGF0LlZhbHVlCmxvY2FsIGluaXRpYWxBZ2lsaXR5ID0gYWdpbGl0eVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEV2aWxLYXJtYSA9IGV2aWxLYXJtYVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEdvb2RLYXJtYSA9IGdvb2RLYXJtYVN0YXQuVmFsdWUKbG9jYWwgaW5pdGlhbEJyYXdscyA9IGJyYXdsc1N0YXQuVmFsdWUKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgbG9jYWwgbGFzdFVwZGF0ZSA9IDAKICAgIHdoaWxlIHRhc2sud2FpdCgwLjIpIGRvCiAgICAgICAgbG9jYWwgZWxhcHNlZFRpbWUgPSB0aWNrKCkgLSBzdGFydFRpbWUKICAgICAgICBsb2NhbCBkYXlzID0gbWF0aC5mbG9vcihlbGFwc2VkVGltZSAvICgyNCAqIDM2MDApKQogICAgICAgIGxvY2FsIGhvdXJzID0gbWF0aC5mbG9vcigoZWxhcHNlZFRpbWUgJSAoMjQgKiAzNjAwKSkgLyAzNjAwKQogICAgICAgIGxvY2FsIG1pbnV0ZXMgPSBtYXRoLmZsb29yKChlbGFwc2VkVGltZSAlIDM2MDApIC8gNjApCiAgICAgICAgbG9jYWwgc2Vjb25kcyA9IG1hdGguZmxvb3IoZWxhcHNlZFRpbWUgJSA2MCkKICAgICAgICBzdG9wd2F0Y2hMYWJlbC5UZXh0ID0gc3RyaW5nLmZvcm1hdCgiU2Vzc2lvbiBUaW1lOiAlZGQgJWRoICVkbSAlZHMiLCBkYXlzLCBob3VycywgbWludXRlcywgc2Vjb25kcykKCiAgICAgICAgaWYgaXNDdXN0b21SdW5uaW5nIHRoZW4KICAgICAgICAgICAgY3VzdG9tRWxhcHNlZCA9IHRpY2soKSAtIGN1c3RvbVN0YXJ0CiAgICAgICAgZW5kCiAgICAgICAgaWYgY3VzdG9tRWxhcHNlZCA+IDAgdGhlbgogICAgICAgICAgICBsb2NhbCBkID0gbWF0aC5mbG9vcihjdXN0b21FbGFwc2VkIC8gKDI0ICogMzYwMCkpCiAgICAgICAgICAgIGxvY2FsIGggPSBtYXRoLmZsb29yKChjdXN0b21FbGFwc2VkICUgKDI0ICogMzYwMCkpIC8gMzYwMCkKICAgICAgICAgICAgbG9jYWwgbSA9IG1hdGguZmxvb3IoKGN1c3RvbUVsYXBzZWQgJSAzNjAwKSAvIDYwKQogICAgICAgICAgICBsb2NhbCBzID0gbWF0aC5mbG9vcihjdXN0b21FbGFwc2VkICUgNjApCiAgICAgICAgICAgIGN1c3RvbVRpbWVyTGFiZWwuVGV4dCA9IHN0cmluZy5mb3JtYXQoIkN1c3RvbSBUaW1lcjogJWRkICVkaCAlZG0gJWRzIiwgZCwgaCwgbSwgcykKICAgICAgICBlbmQKCiAgICAgICAgaWYgcmVzZXRTZXNzaW9uIHRoZW4KICAgICAgICAgICAgc3RhcnRUaW1lID0gdGljaygpCiAgICAgICAgICAgIGluaXRpYWxTdHJlbmd0aCA9IHN0cmVuZ3RoU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsRHVyYWJpbGl0eSA9IGR1cmFiaWxpdHlTdGF0LlZhbHVlCiAgICAgICAgICAgIGluaXRpYWxSZWJpcnRocyA9IHJlYmlydGhzU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsS2lsbHMgPSBraWxsc1N0YXQuVmFsdWUKICAgICAgICAgICAgaW5pdGlhbEFnaWxpdHkgPSBhZ2lsaXR5U3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsRXZpbEthcm1hID0gZXZpbEthcm1hU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsR29vZEthcm1hID0gZ29vZEthcm1hU3RhdC5WYWx1ZQogICAgICAgICAgICBpbml0aWFsQnJhd2xzID0gYnJhd2xzU3RhdC5WYWx1ZQogICAgICAgICAgICByZXNldFNlc3Npb24gPSBmYWxzZQogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBjU3RyID0gc3RyZW5ndGhTdGF0LlZhbHVlCiAgICAgICAgbG9jYWwgY1JlYiA9IHJlYmlydGhzU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNEdXIgPSBkdXJhYmlsaXR5U3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNLaWxscyA9IGtpbGxzU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNBZ2kgPSBhZ2lsaXR5U3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNFdmlsID0gZXZpbEthcm1hU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNHb29kID0gZ29vZEthcm1hU3RhdC5WYWx1ZQogICAgICAgIGxvY2FsIGNCcmF3bCA9IGJyYXdsc1N0YXQuVmFsdWUKCiAgICAgICAgbG9jYWwgZFN0ciA9IGNTdHIgLSBpbml0aWFsU3RyZW5ndGgKICAgICAgICBsb2NhbCBkRHVyID0gY0R1ciAtIGluaXRpYWxEdXJhYmlsaXR5CiAgICAgICAgbG9jYWwgZFJlYiA9IGNSZWIgLSBpbml0aWFsUmViaXJ0aHMKICAgICAgICBsb2NhbCBkS2lsbHMgPSBjS2lsbHMgLSBpbml0aWFsS2lsbHMKICAgICAgICBsb2NhbCBkQWdpID0gY0FnaSAtIGluaXRpYWxBZ2lsaXR5CiAgICAgICAgbG9jYWwgZEV2aWwgPSBjRXZpbCAtIGluaXRpYWxFdmlsS2FybWEKICAgICAgICBsb2NhbCBkR29vZCA9IGNHb29kIC0gaW5pdGlhbEdvb2RLYXJtYQogICAgICAgIGxvY2FsIGRCcmF3bCA9IGNCcmF3bCAtIGluaXRpYWxCcmF3bHMKCiAgICAgICAgc3RyZW5ndGhMYWJlbC5UZXh0ID0gIlN0cmVuZ3RoOiAiIC4uIEFiYnJldk51bWJlcihjU3RyKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRTdHIpCiAgICAgICAgcmViaXJ0aHNMYWJlbC5UZXh0ID0gIlJlYmlydGhzOiAiIC4uIEFiYnJldk51bWJlcihjUmViKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRSZWIpCiAgICAgICAga2lsbHNMYWJlbC5UZXh0ID0gIktpbGxzOiAiIC4uIEFiYnJldk51bWJlcihjS2lsbHMpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEtpbGxzKQogICAgICAgIGJyYXdsc0xhYmVsLlRleHQgPSAiQnJhd2xzOiAiIC4uIEFiYnJldk51bWJlcihjQnJhd2wpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEJyYXdsKQoKICAgICAgICBnb29kS2FybWFMYWJlbC5UZXh0ID0gIkdvb2QgS2FybWE6ICIgLi4gQWJicmV2TnVtYmVyKGNHb29kKSAuLiAiIHwgKyIgLi4gQWJicmV2TnVtYmVyKGRHb29kKQogICAgICAgIGV2aWxLYXJtYUxhYmVsLlRleHQgPSAiRXZpbCBLYXJtYTogIiAuLiBBYmJyZXZOdW1iZXIoY0V2aWwpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEV2aWwpCiAgICAgICAgZHVyYWJpbGl0eUxhYmVsLlRleHQgPSAiRHVyYWJpbGl0eTogIiAuLiBBYmJyZXZOdW1iZXIoY0R1cikgLi4gIiB8ICsiIC4uIEFiYnJldk51bWJlcihkRHVyKQogICAgICAgIGFnaWxpdHlMYWJlbC5UZXh0ID0gIkFnaWxpdHk6ICIgLi4gQWJicmV2TnVtYmVyKGNBZ2kpIC4uICIgfCArIiAuLiBBYmJyZXZOdW1iZXIoZEFnaSkKCiAgICAgICAgaWYgdGljaygpIC0gbGFzdFVwZGF0ZSA+PSA2IHRoZW4KICAgICAgICAgICAgbGFzdFVwZGF0ZSA9IHRpY2soKQogICAgICAgICAgICBsb2NhbCBzU2VjID0gZFN0ciAvIGVsYXBzZWRUaW1lCiAgICAgICAgICAgIGxvY2FsIGRTZWMgPSBkRHVyIC8gZWxhcHNlZFRpbWUKICAgICAgICAgICAgbG9jYWwgclNlYyA9IGRSZWIgLyBlbGFwc2VkVGltZQoKICAgICAgICAgICAgbG9jYWwgaCA9IDM2MDAKICAgICAgICAgICAgbG9jYWwgZCA9IDg2NDAwCgogICAgICAgICAgICBwcm9qZWN0ZWRTdHJlbmd0aExhYmVsLlRleHQgPSAiU3RyZW5ndGggUGFjZTogIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihzU2VjICogaCkpIC4uICIvaCB8ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3Ioc1NlYyAqIGQpKSAuLiAiL2QiCiAgICAgICAgICAgIHByb2plY3RlZER1cmFiaWxpdHlMYWJlbC5UZXh0ID0gIkR1cmFiaWxpdHkgUGFjZTogIiAuLiBBYmJyZXZOdW1iZXIobWF0aC5mbG9vcihkU2VjICogaCkpIC4uICIvaCB8ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3IoZFNlYyAqIGQpKSAuLiAiL2QiCiAgICAgICAgICAgIHByb2plY3RlZFJlYmlydGhzTGFiZWwuVGV4dCA9ICJSZWJpcnRoIFBhY2U6ICIgLi4gQWJicmV2TnVtYmVyKG1hdGguZmxvb3IoclNlYyAqIGgpKSAuLiAiL2ggfCAiIC4uIEFiYnJldk51bWJlcihtYXRoLmZsb29yKHJTZWMgKiBkKSkgLi4gIi9kIgogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCi0tIFNwZWNzCgpsb2NhbCBTZWxlY3RQbGF5ZXJOYW1lID0gIiIKCmxvY2FsIFBsYXllckRyb3AgPSBlc3RhZGlzdGljYXM6QWRkRHJvcGRvd24oIlNlbGVjdCBQbGF5ZXIiLCBmdW5jdGlvbihWYWx1ZSkKICAgIFNlbGVjdFBsYXllck5hbWUgPSBWYWx1ZTptYXRjaCgifCAoLispIikKICAgIHByZXZpb3VzVmFsdWVzID0ge30KZW5kKQoKbG9jYWwgUGxheWVyc2xpc3QgPSB7fQpmb3IgXywgUGxyIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkdldFBsYXllcnMoKSkgZG8KICAgIGxvY2FsIGRpc3BsYXlOYW1lID0gUGxyLkRpc3BsYXlOYW1lIC4uICIgfCAiIC4uIFBsci5OYW1lCiAgICB0YWJsZS5pbnNlcnQoUGxheWVyc2xpc3QsIGRpc3BsYXlOYW1lKQplbmQKZm9yIF8sIEFkZFBsciBpbiBpcGFpcnMoUGxheWVyc2xpc3QpIGRvCiAgICBQbGF5ZXJEcm9wOkFkZChBZGRQbHIpCmVuZAoKbG9jYWwgZnVuY3Rpb24gRm9ybWF0TnVtYmVyV2l0aENvbW1hcyhudW1iZXIpCiAgICBsb2NhbCBmb3JtYXR0ZWQgPSB0b3N0cmluZyhudW1iZXIpOnJldmVyc2UoKTpnc3ViKCIoJWQlZCVkKSIsICIlMSwiKTpyZXZlcnNlKCkKICAgIHJldHVybiBmb3JtYXR0ZWQ6Z3N1YigiXiwiLCAiIikKZW5kCgpsb2NhbCBmdW5jdGlvbiBGb3JtYXRBYmJyZXZpYXRlZChudW1iZXIpCiAgICBsb2NhbCBhYmJyZXZpYXRpb25zID0geyIiLCAiSyIsICJNIiwgIkIiLCAiVCIsICJRYSIsICJRaSJ9CiAgICBsb2NhbCBhYmJyZXZpYXRpb25JbmRleCA9IDEKICAgIHdoaWxlIG51bWJlciA+PSAxMDAwIGRvCiAgICAgICAgbnVtYmVyID0gbnVtYmVyIC8gMTAwMAogICAgICAgIGFiYnJldmlhdGlvbkluZGV4ID0gYWJicmV2aWF0aW9uSW5kZXggKyAxCiAgICBlbmQKICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlLjJmIiwgbnVtYmVyKSAuLiBhYmJyZXZpYXRpb25zW2FiYnJldmlhdGlvbkluZGV4XQplbmQKCmxvY2FsIGZ1bmN0aW9uIEZvcm1hdERpc3BsYXkodmFsdWUpCiAgICBsb2NhbCBub3JtYWwgPSBGb3JtYXROdW1iZXJXaXRoQ29tbWFzKHZhbHVlKQogICAgbG9jYWwgYWJicmV2aWF0ZWQgPSBGb3JtYXRBYmJyZXZpYXRlZCh2YWx1ZSkKICAgIHJldHVybiAiWyAiIC4uIG5vcm1hbCAuLiAiIHwgIiAuLiBhYmJyZXZpYXRlZCAuLiAiIF0iCmVuZAoKbG9jYWwgcHJldmlvdXNWYWx1ZXMgPSB7fQoKbG9jYWwgVXBkYXRlID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUyID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUzID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU0ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU1ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU2ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGU5ID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxMCA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKbG9jYWwgVXBkYXRlMTEgPSBlc3RhZGlzdGljYXM6QWRkTGFiZWwoIiIpCmxvY2FsIFVwZGF0ZTEyID0gZXN0YWRpc3RpY2FzOkFkZExhYmVsKCIiKQpsb2NhbCBVcGRhdGUxMyA9IGVzdGFkaXN0aWNhczpBZGRMYWJlbCgiIikKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdGFzay53YWl0KDApIGRvCiAgICAgICAgaWYgU2VsZWN0UGxheWVyTmFtZSB+PSAiIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVyczpGaW5kRmlyc3RDaGlsZChTZWxlY3RQbGF5ZXJOYW1lKQogICAgICAgICAgICBpZiBwbGF5ZXIgdGhlbgogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJHZW1zIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEuVGV4dCA9ICJHZW1zOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLkdlbXMuVmFsdWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIHBsYXllcjpGaW5kRmlyc3RDaGlsZCgiQWdpbGl0eSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUzLlRleHQgPSAiQWdpbGl0eTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5BZ2lsaXR5LlZhbHVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBwbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIkR1cmFiaWxpdHkiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlNC5UZXh0ID0gIkR1cmFiaWxpdHk6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuRHVyYWJpbGl0eS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJtdXNjbGVLaW5nVGltZSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGU2LlRleHQgPSAiTXVzY2xlIEtpbmcgVGltZTogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5tdXNjbGVLaW5nVGltZS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXN0b21TaXplIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTEwLlRleHQgPSAiQ3VzdG9tIFNpemU6ICIgLi4gRm9ybWF0RGlzcGxheShwbGF5ZXIuY3VzdG9tU2l6ZS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXN0b21TcGVlZCIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBVcGRhdGUxMS5UZXh0ID0gIkN1c3RvbSBTcGVlZDogIiAuLiBGb3JtYXREaXNwbGF5KHBsYXllci5jdXN0b21TcGVlZC5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJldmlsS2FybWEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTIuVGV4dCA9ICJFdmlsIEthcm1hOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmV2aWxLYXJtYS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJnb29kS2FybWEiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlMTMuVGV4dCA9ICJHb29kIEthcm1hOiAiIC4uIEZvcm1hdERpc3BsYXkocGxheWVyLmdvb2RLYXJtYS5WYWx1ZSkKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIGxlYWRlcnN0YXRzID0gcGxheWVyOkZpbmRGaXJzdENoaWxkKCJsZWFkZXJzdGF0cyIpCiAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgaWYgbGVhZGVyc3RhdHM6RmluZEZpcnN0Q2hpbGQoIlN0cmVuZ3RoIikgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBVcGRhdGUuVGV4dCA9ICJTdHJlbmd0aDogIiAuLiBGb3JtYXREaXNwbGF5KGxlYWRlcnN0YXRzLlN0cmVuZ3RoLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIGxlYWRlcnN0YXRzOkZpbmRGaXJzdENoaWxkKCJSZWJpcnRocyIpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgVXBkYXRlMi5UZXh0ID0gIlJlYmlydGg6ICIgLi4gRm9ybWF0RGlzcGxheShsZWFkZXJzdGF0cy5SZWJpcnRocy5WYWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBpZiBsZWFkZXJzdGF0czpGaW5kRmlyc3RDaGlsZCgiS2lsbHMiKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIFVwZGF0ZTUuVGV4dCA9ICJLaWxsczogIiAuLiBGb3JtYXREaXNwbGF5KGxlYWRlcnN0YXRzLktpbGxzLlZhbHVlKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgaWYgcGxheWVyOkZpbmRGaXJzdENoaWxkKCJjdXJyZW50TWFwIikgdGhlbgogICAgICAgICAgICAgICAgICAgIFVwZGF0ZTkuVGV4dCA9ICJDdXJyZW50IE1hcDogIiAuLiB0b3N0cmluZyhwbGF5ZXIuY3VycmVudE1hcC5WYWx1ZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBVcGRhdGU5LlRleHQgPSAiQ3VycmVudCBNYXA6IEF1Y3VuZSBkb25uw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrMWhw4PigJrDgsKpZSIKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLS0gTWlzYyArIFRlbGVwb3J0Cgpsb2NhbCBhbnRpQUZLRW5hYmxlZCA9IHRydWUKTWlzYzpBZGRCdXR0b24oIkFudGkgQWZrIiwgZnVuY3Rpb24oYm9vbCkKICAgIGFudGlBRktFbmFibGVkID0gYm9vbAogICAgCiAgICBpZiBib29sIHRoZW4KICAgICAgICBzZXR1cEFudGlBRksoKQogICAgZWxzZQogICAgICAgIGlmIGFudGlBRktDb25uZWN0aW9uIHRoZW4KICAgICAgICAgICAgYW50aUFGS0Nvbm5lY3Rpb246RGlzY29ubmVjdCgpCiAgICAgICAgICAgIGFudGlBRktDb25uZWN0aW9uID0gbmlsCiAgICAgICAgICAgIHByaW50KCJBbnRpLUFGSyBzeXN0ZW0gZGlzYWJsZWQiKQogICAgICAgIGVuZAogICAgZW5kCmVuZCwgdHJ1ZSkKCmxvY2FsIHN3aXRjaCA9IE1pc2M6QWRkU3dpdGNoKCJMb2NrIFBvc2l0aW9uIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBpZiBWYWx1ZSB0aGVuCiAgICAgICAgCiAgICAgICAgbG9jYWwgY3VycmVudFBvcyA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUKICAgICAgICBnZXRnZW52KCkucG9zTG9jayA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4KICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBjdXJyZW50UG9zCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICAKICAgICAgICBpZiBnZXRnZW52KCkucG9zTG9jayB0aGVuCiAgICAgICAgICAgIGdldGdlbnYoKS5wb3NMb2NrOkRpc2Nvbm5lY3QoKQogICAgICAgICAgICBnZXRnZW52KCkucG9zTG9jayA9IG5pbAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCk1pc2M6QWRkU3dpdGNoKCJBbnRpIEtub2NrYmFjayIsIGZ1bmN0aW9uKFZhbHVlKQogICAgaWYgVmFsdWUgdGhlbgogICAgICAgIGxvY2FsIHBsYXllck5hbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZQogICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gZ2FtZS5Xb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQocGxheWVyTmFtZSk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGxvY2FsIGJvZHlWZWxvY2l0eSA9IEluc3RhbmNlLm5ldygiQm9keVZlbG9jaXR5IikKICAgICAgICBib2R5VmVsb2NpdHkuTWF4Rm9yY2UgPSBWZWN0b3IzLm5ldygxMDAwMDAsIDAsIDEwMDAwMCkKICAgICAgICBib2R5VmVsb2NpdHkuVmVsb2NpdHkgPSBWZWN0b3IzLm5ldygwLCAwLCAwKQogICAgICAgIGJvZHlWZWxvY2l0eS5QID0gMTI1MAogICAgICAgIGJvZHlWZWxvY2l0eS5QYXJlbnQgPSByb290UGFydAogICAgZWxzZQogICAgICAgIGxvY2FsIHBsYXllck5hbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZQogICAgICAgIGxvY2FsIHJvb3RQYXJ0ID0gZ2FtZS5Xb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQocGxheWVyTmFtZSk6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQogICAgICAgIGxvY2FsIGV4aXN0aW5nVmVsb2NpdHkgPSByb290UGFydDpGaW5kRmlyc3RDaGlsZCgiQm9keVZlbG9jaXR5IikKICAgICAgICBpZiBleGlzdGluZ1ZlbG9jaXR5IGFuZCBleGlzdGluZ1ZlbG9jaXR5Lk1heEZvcmNlID09IFZlY3RvcjMubmV3KDEwMDAwMCwgMCwgMTAwMDAwKSB0aGVuCiAgICAgICAgICAgIGV4aXN0aW5nVmVsb2NpdHk6RGVzdHJveSgpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKTWlzYzpBZGRCdXR0b24oIlJlbW92ZSBQb3J0YWxzIiwgZnVuY3Rpb24oKQogICAgZm9yIF8sIHBvcnRhbCBpbiBwYWlycyhnYW1lOkdldERlc2NlbmRhbnRzKCkpIGRvCiAgICAgICAgaWYgcG9ydGFsLk5hbWUgPT0gIlJvYmxveEZvcndhcmRQb3J0YWxzIiB0aGVuCiAgICAgICAgICAgIHBvcnRhbDpEZXN0cm95KCkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICBpZiBfRy5BZFJlbW92YWxDb25uZWN0aW9uIHRoZW4KICAgICAgICBfRy5BZFJlbW92YWxDb25uZWN0aW9uOkRpc2Nvbm5lY3QoKQogICAgZW5kCiAgICAKICAgIF9HLkFkUmVtb3ZhbENvbm5lY3Rpb24gPSBnYW1lLkRlc2NlbmRhbnRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKGRlc2NlbmRhbnQpCiAgICAgICAgaWYgZGVzY2VuZGFudC5OYW1lID09ICJSb2Jsb3hGb3J3YXJkUG9ydGFscyIgdGhlbgogICAgICAgICAgICBkZXNjZW5kYW50OkRlc3Ryb3koKQogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIkFudW5jaW9zIEVsaW1pbmFkb3MiLAogICAgICAgIFRleHQgPSAiTG9zIGFudW5jaW9zIGRlIFJvYmxveCBoYW4gc2lkbyBlbGltaW5hZG9zIiwKICAgICAgICBEdXJhdGlvbiA9IDAKICAgIH0pCmVuZCkKCmxvY2FsIHRpbWVEcm9wZG93biA9IE1pc2M6QWRkRHJvcGRvd24oIkNoYW5nZSBUaW1lIiwgZnVuY3Rpb24oc2VsZWN0aW9uKQogICAgbG9jYWwgbGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikKICAgIAogICAgaWYgc2VsZWN0aW9uID09ICJOaWdodCIgdGhlbgogICAgICAgIGxpZ2h0aW5nLkNsb2NrVGltZSA9IDAKICAgIGVsc2VpZiBzZWxlY3Rpb24gPT0gIkRheSIgdGhlbgogICAgICAgIGxpZ2h0aW5nLkNsb2NrVGltZSA9IDEyCiAgICBlbHNlaWYgc2VsZWN0aW9uID09ICJNaWRuaWdodCIgdGhlbgogICAgICAgIGxpZ2h0aW5nLkNsb2NrVGltZSA9IDYKICAgIGVuZAogICAgCiAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlKCJTZW5kTm90aWZpY2F0aW9uIiwgewogICAgICAgIFRpdGxlID0gIkhvcmEgQ2FtYmlhZGEiLAogICAgICAgIFRleHQgPSAiTGEgaG9yYSBkZWwgZMODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw6Ligqwgw4PCosOi4oCawqzDouKAnsKiw4PGksOG4oCZw4PCosOi4oCawqwgw4PGksOCwqLDg8Kiw6LigqzFocOCwqzDg8Kiw6LigqzFvsOCwqLDg8aSw4bigJnDg+KAoMOi4oKs4oSiw4PGksOCwqLDg8Kiw6LigqzFocOCwqwgw4PGksOG4oCZw4PigJrDgsKiw4PGksOCwqLDg8Kiw6LigJrCrMOFwqHDg+KAmsOCwqzDg8aSw4LCosODwqLDouKAmsKsw4XCvsOD4oCaw4LCosODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw6Ligqwgw4PCosOi4oCawqzDouKAnsKiw4PGksOG4oCZw4PigJrDgsKiw4PGksOCwqLDg8Kiw6LigJrCrMOFwqHDg+KAmsOCwqwgw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrMWhw4PigJrDgsKiw4PGksOG4oCZw4PigJrDgsKiw4PGksOCwqLDg8Kiw6LigqzFocOCwqzDg+KApsOCwqHDg8aSw6LigqzFocOD4oCaw4LCrMODxpLDhuKAmcOD4oCaw4LCosODxpLDgsKiw4PCosOi4oKsxaHDgsKsw4PigKbDgsK+w4PGksOi4oKsxaHDg+KAmsOCwqLDg8aSw4bigJnDg+KAoMOi4oKs4oSiw4PGksOi4oKsIMODwqLDouKAmsKsw6LigJ7CosODxpLDhuKAmcODwqLDouKAmsKsIMODxpLDgsKiw4PCosOi4oKsxaHDgsKsw4PCosOi4oKsxb7DgsKiw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrMWhw4PigJrDgsKiw4PGksOG4oCZw4PigJrDgsKiw4PGksOCwqLDg8Kiw6LigqzFocOCwqzDg+KApsOCwqHDg8aSw6LigqzFocOD4oCaw4LCrCDDg8aSw4bigJnDg+KAoMOi4oKs4oSiw4PGksOi4oKsIMODwqLDouKAmsKsw6LigJ7CosODxpLDhuKAmcODwqLDouKAmsKsw4XCocODxpLDouKCrMWhw4PigJrDgsKiw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrMWhw4PigJrDgsKiw4PGksOG4oCZw4PigJrDgsKiw4PGksOCwqLDg8Kiw6LigJrCrMOFwqHDg+KAmsOCwqzDg8aSw6LigqzCpsOD4oCaw4LCocODxpLDhuKAmcODwqLDouKAmsKsw4XCocODxpLDouKCrMWhw4PigJrDgsKsw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrMWhw4PigJrDgsKiw4PGksOG4oCZw4PigJrDgsKiw4PGksOCwqLDg8Kiw6LigJrCrMOFwqHDg+KAmsOCwqzDg8aSw6LigqzCpsOD4oCaw4LCvsODxpLDhuKAmcODwqLDouKAmsKsw4XCocODxpLDouKCrMWhw4PigJrDgsKiw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrCDDg8Kiw6LigJrCrMOi4oCewqLDg8aSw4bigJnDg8Kiw6LigJrCrCDDg8aSw4LCosODwqLDouKCrMWhw4LCrMODwqLDouKCrMW+w4LCosODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw4LCosODwqLDouKCrMWhw4LCrCDDg8aSw4bigJnDg+KAmsOCwqLDg8aSw4LCosODwqLDouKAmsKsw4XCocOD4oCaw4LCrMODxpLDgsKiw4PCosOi4oCawqzDhcK+w4PigJrDgsKiw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrCDDg8Kiw6LigJrCrMOi4oCewqLDg8aSw4bigJnDg8Kiw6LigJrCrMOFwqHDg8aSw6LigqzFocOD4oCaw4LCosODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw6LigqzFocOD4oCaw4LCosODxpLDhuKAmcOD4oCaw4LCosODxpLDgsKiw4PCosOi4oCawqzDhcKhw4PigJrDgsKsw4PGksOi4oKswqbDg+KAmsOCwqHDg8aSw4bigJnDg8Kiw6LigJrCrMOFwqHDg8aSw6LigqzFocOD4oCaw4LCrMODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw4LCosODwqLDouKCrMWhw4LCrMOD4oCaw4LCpsODxpLDhuKAmcODwqLDouKAmsKsw4XCocODxpLDouKCrMWhw4PigJrDgsKhw4PGksOG4oCZw4PigKDDouKCrOKEosODxpLDouKCrCDDg8Kiw6LigJrCrMOi4oCewqLDg8aSw4bigJnDg8Kiw6LigJrCrCDDg8aSw4LCosODwqLDouKCrMWhw4LCrMODwqLDouKCrMW+w4LCosODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw6LigqzFocOD4oCaw4LCosODxpLDhuKAmcOD4oCaw4LCosODxpLDgsKiw4PCosOi4oKsxaHDgsKsw4PigKbDgsKhw4PGksOi4oKsxaHDg+KAmsOCwqzDg8aSw4bigJnDg8Kiw6LigJrCrMOCwqbDg8aSw6LigqzFocOD4oCaw4LCocODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw6Ligqwgw4PCosOi4oCawqzDouKAnsKiw4PGksOG4oCZw4PigJrDgsKiw4PGksOCwqLDg8Kiw6LigJrCrMOFwqHDg+KAmsOCwqzDg8aSw6LigqzCpsOD4oCaw4LCocODxpLDhuKAmcOD4oCgw6LigqzihKLDg8aSw4LCosODwqLDouKCrMWhw4LCrMOD4oCmw4LCocODxpLDhuKAmcODwqLDouKAmsKsw4XCocODxpLDouKCrMWhw4PigJrDgsKtYSBoYSBzaWRvIGNhbWJpYWRhIGE6ICIgLi4gc2VsZWN0aW9uLAogICAgICAgIER1cmF0aW9uID0gMAogICAgfSkKZW5kKQoKdGltZURyb3Bkb3duOkFkZCgiTmlnaHQiKQp0aW1lRHJvcGRvd246QWRkKCJEYXkiKQp0aW1lRHJvcGRvd246QWRkKCJNaWRuaWdodCIpCgpNaXNjOkFkZFN3aXRjaCgiQXV0byBGb3J0dW5lIFdoZWVsIiwgZnVuY3Rpb24oVmFsdWUpCiAgICBfRy5hdXRvRm9ydHVuZVdoZWVsQWN0aXZlID0gVmFsdWUKICAgIGlmIFZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBmdW5jdGlvbiBvcGVuRm9ydHVuZVdoZWVsKCkKICAgICAgICAgICAgd2hpbGUgX0cuYXV0b0ZvcnR1bmVXaGVlbEFjdGl2ZSBkbwogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsKICAgICAgICAgICAgICAgICAgICBbMV0gPSAib3BlbkZvcnR1bmVXaGVlbCIsCiAgICAgICAgICAgICAgICAgICAgWzJdID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiZm9ydHVuZVdoZWVsQ2hhbmNlcyIpOldhaXRGb3JDaGlsZCgiRm9ydHVuZSBXaGVlbCIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJyRXZlbnRzIik6V2FpdEZvckNoaWxkKCJvcGVuRm9ydHVuZVdoZWVsUmVtb3RlIik6SW52b2tlU2VydmVyKHVucGFjayhhcmdzKSkKICAgICAgICAgICAgICAgIHdhaXQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgY29yb3V0aW5lLndyYXAob3BlbkZvcnR1bmVXaGVlbCkoKQogICAgZWxzZQogICAgICAgIF9HLmF1dG9Gb3J0dW5lV2hlZWxBY3RpdmUgPSBmYWxzZQogICAgZW5kCmVuZCkKCmxvY2FsIGdvZE1vZGVUb2dnbGUgPSBmYWxzZQogICAgICAgIE1pc2M6QWRkU3dpdGNoKCJHb2QgTW9kZSAoQnJhd2wpIiwgZnVuY3Rpb24oU3RhdGUpCiAgICAgICAgICAgIGdvZE1vZGVUb2dnbGUgPSBTdGF0ZQogICAgICAgICAgICBpZiBTdGF0ZSB0aGVuCiAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICB3aGlsZSBnb2RNb2RlVG9nZ2xlIGRvCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5yRXZlbnRzLmJyYXdsRXZlbnQ6RmlyZVNlcnZlcigiam9pbkJyYXdsIikKICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDApCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKCmxvY2FsIHBhcnRzID0ge30KbG9jYWwgcGFydFNpemUgPSAyMDQ4CmxvY2FsIHRvdGFsRGlzdGFuY2UgPSA1MDAwMApsb2NhbCBzdGFydFBvc2l0aW9uID0gVmVjdG9yMy5uZXcoLTIsIC05LjUsIC0yKQpsb2NhbCBudW1iZXJPZlBhcnRzID0gbWF0aC5jZWlsKHRvdGFsRGlzdGFuY2UgLyBwYXJ0U2l6ZSkKCmxvY2FsIGZ1bmN0aW9uIGNyZWF0ZVBhcnRzKCkKICAgIGZvciB4ID0gMCwgbnVtYmVyT2ZQYXJ0cyAtIDEgZG8KICAgICAgICBmb3IgeiA9IDAsIG51bWJlck9mUGFydHMgLSAxIGRvCiAgICAgICAgICAgIGxvY2FsIG5ld1BhcnRTaWRlID0gSW5zdGFuY2UubmV3KCJQYXJ0IikKICAgICAgICAgICAgbmV3UGFydFNpZGUuU2l6ZSA9IFZlY3RvcjMubmV3KHBhcnRTaXplLCAxLCBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFNpZGUuUG9zaXRpb24gPSBzdGFydFBvc2l0aW9uICsgVmVjdG9yMy5uZXcoeCAqIHBhcnRTaXplLCAwLCB6ICogcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0U2lkZS5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLkNhbkNvbGxpZGUgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRTaWRlLk5hbWUgPSAiUGFydF9TaWRlXyIgLi4geCAuLiAiXyIgLi4gegogICAgICAgICAgICBuZXdQYXJ0U2lkZS5QYXJlbnQgPSB3b3Jrc3BhY2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCBuZXdQYXJ0U2lkZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG5ld1BhcnRMZWZ0UmlnaHQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LlNpemUgPSBWZWN0b3IzLm5ldyhwYXJ0U2l6ZSwgMSwgcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuUG9zaXRpb24gPSBzdGFydFBvc2l0aW9uICsgVmVjdG9yMy5uZXcoLXggKiBwYXJ0U2l6ZSwgMCwgeiAqIHBhcnRTaXplKQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LkFuY2hvcmVkID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgbmV3UGFydExlZnRSaWdodC5DYW5Db2xsaWRlID0gdHJ1ZQogICAgICAgICAgICBuZXdQYXJ0TGVmdFJpZ2h0Lk5hbWUgPSAiUGFydF9MZWZ0UmlnaHRfIiAuLiB4IC4uICJfIiAuLiB6CiAgICAgICAgICAgIG5ld1BhcnRMZWZ0UmlnaHQuUGFyZW50ID0gd29ya3NwYWNlCiAgICAgICAgICAgIHRhYmxlLmluc2VydChwYXJ0cywgbmV3UGFydExlZnRSaWdodCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIG5ld1BhcnRVcExlZnQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LlNpemUgPSBWZWN0b3IzLm5ldyhwYXJ0U2l6ZSwgMSwgcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuUG9zaXRpb24gPSBzdGFydFBvc2l0aW9uICsgVmVjdG9yMy5uZXcoLXggKiBwYXJ0U2l6ZSwgMCwgLXogKiBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5BbmNob3JlZCA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5UcmFuc3BhcmVuY3kgPSAxCiAgICAgICAgICAgIG5ld1BhcnRVcExlZnQuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFVwTGVmdC5OYW1lID0gIlBhcnRfVXBMZWZ0XyIgLi4geCAuLiAiXyIgLi4gegogICAgICAgICAgICBuZXdQYXJ0VXBMZWZ0LlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsIG5ld1BhcnRVcExlZnQpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBuZXdQYXJ0VXBSaWdodCA9IEluc3RhbmNlLm5ldygiUGFydCIpCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlNpemUgPSBWZWN0b3IzLm5ldyhwYXJ0U2l6ZSwgMSwgcGFydFNpemUpCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlBvc2l0aW9uID0gc3RhcnRQb3NpdGlvbiArIFZlY3RvcjMubmV3KHggKiBwYXJ0U2l6ZSwgMCwgLXogKiBwYXJ0U2l6ZSkKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuQW5jaG9yZWQgPSB0cnVlCiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlRyYW5zcGFyZW5jeSA9IDEKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICAgICAgbmV3UGFydFVwUmlnaHQuTmFtZSA9ICJQYXJ0X1VwUmlnaHRfIiAuLiB4IC4uICJfIiAuLiB6CiAgICAgICAgICAgIG5ld1BhcnRVcFJpZ2h0LlBhcmVudCA9IHdvcmtzcGFjZQogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsIG5ld1BhcnRVcFJpZ2h0KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKbG9jYWwgZnVuY3Rpb24gbWFrZVBhcnRzV2Fsa3Rocm91Z2goKQogICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKHBhcnRzKSBkbwogICAgICAgIGlmIHBhcnQgYW5kIHBhcnQuUGFyZW50IHRoZW4KICAgICAgICAgICAgcGFydC5DYW5Db2xsaWRlID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIG1ha2VQYXJ0c1NvbGlkKCkKICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhwYXJ0cykgZG8KICAgICAgICBpZiBwYXJ0IGFuZCBwYXJ0LlBhcmVudCB0aGVuCiAgICAgICAgICAgIHBhcnQuQ2FuQ29sbGlkZSA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAplbmQKCk1pc2M6QWRkU3dpdGNoKCJGdWxsIFdhbGsgb24gV2F0ZXIiLCBmdW5jdGlvbihib29sKQogICAgaWYgYm9vbCB0aGVuCiAgICAgICAgY3JlYXRlUGFydHMoKQogICAgZWxzZQogICAgICAgIG1ha2VQYXJ0c1dhbGt0aHJvdWdoKCkKICAgIGVuZAplbmQpCgpNaXNjOkFkZExhYmVsKCJVc2VmdWxsIikKCmxvY2FsIGF1dG9FYXRCb29zdHNFbmFibGVkID0gZmFsc2UKCmxvY2FsIGJvb3N0c0xpc3QgPSB7CiAgICAiVUxUUkEgU2hha2UiLAogICAgIlRPVUdIIEJhciIsCiAgICAiUHJvdGVpbiBTaGFrZSIsCiAgICAiRW5lcmd5IFNoYWtlIiwKICAgICJQcm90ZWluIEJhciIsCiAgICAiRW5lcmd5IEJhciIsCiAgICAiVHJvcGljYWwgU2hha2UiCn0KCmxvY2FsIGZ1bmN0aW9uIGVhdEFsbEJvb3N0cygpCiAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIKICAgIGxvY2FsIGJhY2twYWNrID0gcGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKQogICAgbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyLkNoYXJhY3RlciBvciBwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpCgogICAgZm9yIF8sIGJvb3N0TmFtZSBpbiBpcGFpcnMoYm9vc3RzTGlzdCkgZG8KICAgICAgICBsb2NhbCBib29zdCA9IGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKGJvb3N0TmFtZSkKICAgICAgICB3aGlsZSBib29zdCBkbwogICAgICAgICAgICBib29zdC5QYXJlbnQgPSBjaGFyYWN0ZXIKICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgYm9vc3Q6QWN0aXZhdGUoKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHRhc2sud2FpdCgwKQogICAgICAgICAgICBib29zdCA9IGJhY2twYWNrOkZpbmRGaXJzdENoaWxkKGJvb3N0TmFtZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIGF1dG9FYXRCb29zdHNFbmFibGVkIHRoZW4KICAgICAgICAgICAgZWF0QWxsQm9vc3RzKCkKICAgICAgICAgICAgdGFzay53YWl0KDIpCiAgICAgICAgZWxzZQogICAgICAgICAgICB0YXNrLndhaXQoMSkKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpNaXNjOkFkZFN3aXRjaCgiQXV0byBDbGVhciBJbnZlbnRvcnkiLCBmdW5jdGlvbihzdGF0ZSkKICAgIGF1dG9FYXRCb29zdHNFbmFibGVkID0gc3RhdGUKZW5kKQoKTWlzYzpBZGRMYWJlbCgiICIpLlRleHRTaXplID0gMTUKTWlzYzpBZGRMYWJlbCgiVGVsZXBvcnQiKS5UZXh0U2l6ZSA9IDIwCk1pc2M6QWRkTGFiZWwoIiAiKS5UZXh0U2l6ZSA9IDE1CgpNaXNjOkFkZEJ1dHRvbigiVGlueSBJc2xhbmQiLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMzEuODYyNjE5NCwgNi4wNTg4MDI2LCAyMDg3Ljg4NjcyKQplbmQpCgpNaXNjOkFkZEJ1dHRvbigiU3RhcnRlciBJc2xhbmQiLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygyMjYuMjUyNDcyLCA4LjE1MjY5NDcsIDIxOS4zNjY1MTYpCmVuZCkKCk1pc2M6QWRkQnV0dG9uKCJMZWdlbmQgQmVhY2giLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMzY1Ljc5ODMwOSwgNDQuNTA4MjkzMiwgLTUwMS42MTg1OTEpCmVuZCkKCk1pc2M6QWRkQnV0dG9uKCJGcm9zdCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMjkzMy40Nzk5OCwgMjkuNjM5OTYxMiwgLTU3OS45NDYwNDUpCmVuZCkKCk1pc2M6QWRkQnV0dG9uKCJNeXRoaWNhbCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygyNjU5LjUwNjM1LCAyMS42MDk1MjM4LCA5MzQuNjkwNjEzKQplbmQpCgpNaXNjOkFkZEJ1dHRvbigiRXRlcm5hbCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtNzE3Ni4xOTE0MSwgNDUuMzk0MTA0LCAtMTEwNi4zMTQyMSkKZW5kKQoKTWlzYzpBZGRCdXR0b24oIkxlZ2VuZCBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyg0NDQ2LjkxNjk5LCAxMDA0LjQ2Njk4LCAtMzk4My43NjA3NCkKZW5kKQoKTWlzYzpBZGRCdXR0b24oIkp1bmdsZSBHeW0iLCBmdW5jdGlvbigpCiAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtODEzNywgMjgsIDI4MjApCmVuZCkKTWlzYzpBZGRMYWJlbCgiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIpLlRleHRTaXplID0gMTUKTWlzYzpBZGRMYWJlbCgiVHJhZGluZyIpLlRleHRTaXplID0gMTUKCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQoKbG9jYWwgcGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcgpsb2NhbCByRXZlbnRzID0gUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy50cmFkaW5nRXZlbnQKCmxvY2FsIHRyYWRpbmdFbmFibGVkID0gZmFsc2UKbG9jYWwgc2VsZWN0ZWRQZXQgPSBuaWwKbG9jYWwgdHJhZGVBY3RpdmUgPSBmYWxzZQoKLS0g8J+UuSBBY3RpdmF0ZSBTd2l0Y2gKbG9jYWwgc3dpdGNoID0gTWlzYzpBZGRTd2l0Y2goIkFjdGl2YXRlIFRyYWRpbmciLCBmdW5jdGlvbihzdGF0ZSkKICAgIHRyYWRpbmdFbmFibGVkID0gc3RhdGUKZW5kKQpzd2l0Y2g6U2V0KHRydWUpCgotLSDwn5S5IERyb3Bkb3duOiBTZWxlY3QgUGV0CmxvY2FsIGRyb3Bkb3duID0gTWlzYzpBZGREcm9wZG93bigiU2VsZWN0IFBldCIsIGZ1bmN0aW9uKHRleHQpCiAgICBsb2NhbCBwZXROYW1lID0gdGV4dDptYXRjaCgiXiguKikgJSgiKQogICAgaWYgcGV0TmFtZSB0aGVuCiAgICAgICAgc2VsZWN0ZWRQZXQgPSBwZXROYW1lCiAgICBlbmQKZW5kKQoKLS0g8J+UuSBEcm9wZG93biBPcHRpb25zCmRyb3Bkb3duOkFkZCgiTmVvbiBHdWFyZGlhbiAoVW5pcXVlKSIpCmRyb3Bkb3duOkFkZCgiTXVzY2xlIFNlbnNlaSAoVW5pcXVlKSIpCmRyb3Bkb3duOkFkZCgiRGFya3N0YXIgSHVudGVyIChVbmlxdWUpIikKZHJvcGRvd246QWRkKCJDeWJlcm5ldGljIFNob3dkb3duIERyYWdvbiAoVW5pcXVlKSIpCmRyb3Bkb3duOkFkZCgiTWFnaWMgQnV0dGVyZmx5IChVbmlxdWUpIikKZHJvcGRvd246QWRkKCJJbmZlcm5hbCBEcmFnb24gKFVuaXF1ZSkiKQoKLS0g8J+UuSBDb250aW51b3VzbHkgYWNjZXB0IHRyYWRlIHJlcXVlc3RzCnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgaWYgdHJhZGluZ0VuYWJsZWQgYW5kIG5vdCB0cmFkZUFjdGl2ZSB0aGVuCiAgICAgICAgICAgIHJFdmVudHM6RmlyZVNlcnZlcigicmVxdWVzdEFjY2VwdGVkIikKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgotLSDwn5S5IEhhbmRsZSBzZWxlY3RlZCBwZXQgc2VxdWVudGlhbGx5CnRhc2suc3Bhd24oZnVuY3Rpb24oKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgaWYgdHJhZGluZ0VuYWJsZWQgYW5kIHNlbGVjdGVkUGV0IGFuZCBub3QgdHJhZGVBY3RpdmUgdGhlbgogICAgICAgICAgICB0cmFkZUFjdGl2ZSA9IHRydWUgLS0gcHJldmVudCBvdmVybGFwcGluZwoKICAgICAgICAgICAgLS0gMe+4j+KDoyBGaXJlIG9mZmVySXRlbSAzMCB0aW1lcyBpbiAwLjJzCiAgICAgICAgICAgIGZvciBpID0gMSwgMzAgZG8KICAgICAgICAgICAgICAgIHJFdmVudHM6RmlyZVNlcnZlcigib2ZmZXJJdGVtIiwgcGxheWVyLnBldHNGb2xkZXIuVW5pcXVlW3NlbGVjdGVkUGV0XSkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjIgLyAzMCkgLS0gfjAuMDA2N3MgYmV0d2VlbiBlYWNoIG9mZmVyCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS0gMu+4j+KDoyBGaXJlIGFjY2VwdFRyYWRlIDMwIHRpbWVzIGluIDAuNXMKICAgICAgICAgICAgZm9yIGkgPSAxLCAzMCBkbwogICAgICAgICAgICAgICAgckV2ZW50czpGaXJlU2VydmVyKCJhY2NlcHRUcmFkZSIpCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41IC8gMzApIC0tIH4wLjAxNjdzIGJldHdlZW4gZWFjaCBhY2NlcHQKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAtLSBSZXNldCBzdGF0ZQogICAgICAgICAgICBzZWxlY3RlZFBldCA9IG5pbAogICAgICAgICAgICB0cmFkZUFjdGl2ZSA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKQoKTWlzYzpBZGRMYWJlbCgiPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIpLlRleHRTaXplID0gMTUKTWlzYzpBZGRMYWJlbCgiR2lmdGluZyIpLlRleHRTaXplID0gMTUKCk1pc2M6QWRkTGFiZWwoIkdpZnRpbmcgUHJvdGVpbiBlZ2c6IikuVGV4dFNpemUgPSAyMgoKbG9jYWwgcHJvdGVpbkVnZ0xhYmVsID0gTWlzYzpBZGRMYWJlbCgiUHJvdGVpbiBFZ2dzOiAwIikKcHJvdGVpbkVnZ0xhYmVsLlRleHRTaXplID0gMjAKCmxvY2FsIHNlbGVjdGVkRWdnUGxheWVyID0gbmlsCmxvY2FsIGVnZ0NvdW50ID0gMAoKbG9jYWwgZWdnRHJvcGRvd24gPSBNaXNjOkFkZERyb3Bkb3duKCJQbGF5ZXIgdG8gR2lmdCBFZ2dzIiwgZnVuY3Rpb24oc2VsZWN0ZWREaXNwbGF5TmFtZSkKICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgIGlmIHBsci5EaXNwbGF5TmFtZSA9PSBzZWxlY3RlZERpc3BsYXlOYW1lIHRoZW4KICAgICAgICAgICAgc2VsZWN0ZWRFZ2dQbGF5ZXIgPSBwbHIKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAplbmQpCgpmb3IgXywgcGxyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8KICAgIGlmIHBsciB+PSBQbGF5ZXJzLkxvY2FsUGxheWVyIHRoZW4KICAgICAgICBlZ2dEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZAoKUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBscikKICAgIGlmIHBsciB+PSBQbGF5ZXJzLkxvY2FsUGxheWVyIHRoZW4KICAgICAgICBlZ2dEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZCkKCk1pc2M6QWRkVGV4dEJveCgiQW1vdW50IG9mIEVnZ3MiLCBmdW5jdGlvbih0ZXh0KQogICAgZWdnQ291bnQgPSB0b251bWJlcih0ZXh0KSBvciAwCmVuZCkKCk1pc2M6QWRkQnV0dG9uKCJHaWZ0IEVnZ3MiLCBmdW5jdGlvbigpCiAgICBpZiBzZWxlY3RlZEVnZ1BsYXllciBhbmQgZWdnQ291bnQgPiAwIHRoZW4KICAgICAgICBmb3IgaSA9IDEsIGVnZ0NvdW50IGRvCiAgICAgICAgICAgIGxvY2FsIGVnZyA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuY29uc3VtYWJsZXNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIlByb3RlaW4gRWdnIikKICAgICAgICAgICAgaWYgZWdnIHRoZW4KICAgICAgICAgICAgICAgIFJlcGxpY2F0ZWRTdG9yYWdlLnJFdmVudHMuZ2lmdFJlbW90ZTpJbnZva2VTZXJ2ZXIoImdpZnRSZXF1ZXN0Iiwgc2VsZWN0ZWRFZ2dQbGF5ZXIsIGVnZykKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCk1pc2M6QWRkTGFiZWwoIkdpZnRpbmcgVHJvcGljYWwgU2hha2VzOiIpLlRleHRTaXplID0gMjIKCmxvY2FsIHRyb3BpY2FsU2hha2VMYWJlbCA9IE1pc2M6QWRkTGFiZWwoIlRyb3BpY2FsIFNoYWtlczogMCIpCnRyb3BpY2FsU2hha2VMYWJlbC5UZXh0U2l6ZSA9IDE4Cgpsb2NhbCBzZWxlY3RlZFNoYWtlUGxheWVyID0gbmlsCmxvY2FsIHNoYWtlQ291bnQgPSAwCgpsb2NhbCBzaGFrZURyb3Bkb3duID0gTWlzYzpBZGREcm9wZG93bigiUGxheWVyIHRvIEdpZnQgVHJvcGljYWwgU2hha2VzIiwgZnVuY3Rpb24oc2VsZWN0ZWREaXNwbGF5TmFtZSkKICAgIGZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgICAgIGlmIHBsci5EaXNwbGF5TmFtZSA9PSBzZWxlY3RlZERpc3BsYXlOYW1lIHRoZW4KICAgICAgICAgICAgc2VsZWN0ZWRTaGFrZVBsYXllciA9IHBscgogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmZvciBfLCBwbHIgaW4gaXBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbwogICAgaWYgcGxyIH49IFBsYXllcnMuTG9jYWxQbGF5ZXIgdGhlbgogICAgICAgIHNoYWtlRHJvcGRvd246QWRkKHBsci5EaXNwbGF5TmFtZSkKICAgIGVuZAplbmQKClBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbHIpCiAgICBpZiBwbHIgfj0gUGxheWVycy5Mb2NhbFBsYXllciB0aGVuCiAgICAgICAgc2hha2VEcm9wZG93bjpBZGQocGxyLkRpc3BsYXlOYW1lKQogICAgZW5kCmVuZCkKCk1pc2M6QWRkVGV4dEJveCgiVHJvcGljYWwgU2hha2VzIGdpZnQiLCBmdW5jdGlvbih0ZXh0KQogICAgc2hha2VDb3VudCA9IHRvbnVtYmVyKHRleHQpIG9yIDAKZW5kKQoKTWlzYzpBZGRCdXR0b24oIkdpZnQgVHJvcGljYWwgU2hha2VzIiwgZnVuY3Rpb24oKQogICAgaWYgc2VsZWN0ZWRTaGFrZVBsYXllciBhbmQgc2hha2VDb3VudCA+IDAgdGhlbgogICAgICAgIGZvciBpID0gMSwgc2hha2VDb3VudCBkbwogICAgICAgICAgICBsb2NhbCBzaGFrZSA9IFBsYXllcnMuTG9jYWxQbGF5ZXIuY29uc3VtYWJsZXNGb2xkZXI6RmluZEZpcnN0Q2hpbGQoIlRyb3BpY2FsIFNoYWtlIikKICAgICAgICAgICAgaWYgc2hha2UgdGhlbgogICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuckV2ZW50cy5naWZ0UmVtb3RlOkludm9rZVNlcnZlcigiZ2lmdFJlcXVlc3QiLCBzZWxlY3RlZFNoYWtlUGxheWVyLCBzaGFrZSkKICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCmxvY2FsIGZ1bmN0aW9uIHVwZGF0ZUl0ZW1Db3VudCgpCiAgICBsb2NhbCBwcm90ZWluRWdnQ291bnQgPSAwCiAgICBsb2NhbCB0cm9waWNhbFNoYWtlQ291bnQgPSAwCgogICAgbG9jYWwgYmFja3BhY2sgPSBQbGF5ZXJzLkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKQogICAgaWYgYmFja3BhY2sgdGhlbgogICAgICAgIGZvciBfLCBpdGVtIGluIGlwYWlycyhiYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbwogICAgICAgICAgICBpZiBpdGVtLk5hbWUgPT0gIlByb3RlaW4gRWdnIiB0aGVuCiAgICAgICAgICAgICAgICBwcm90ZWluRWdnQ291bnQgPSBwcm90ZWluRWdnQ291bnQgKyAxCiAgICAgICAgICAgIGVsc2VpZiBpdGVtLk5hbWUgPT0gIlRyb3BpY2FsIFNoYWtlIiBvciBpdGVtLk5hbWUgPT0gIlBpw4PGksOG4oCZw4PigJrDgsKxYXMiIHRoZW4KICAgICAgICAgICAgICAgIHRyb3BpY2FsU2hha2VDb3VudCA9IHRyb3BpY2FsU2hha2VDb3VudCArIDEKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBwcm90ZWluRWdnTGFiZWwuVGV4dCA9ICJQcm90ZWluIEVnZ3M6ICIgLi4gcHJvdGVpbkVnZ0NvdW50CiAgICB0cm9waWNhbFNoYWtlTGFiZWwuVGV4dCA9ICJUcm9waWNhbCBTaGFrZXM6ICIgLi4gdHJvcGljYWxTaGFrZUNvdW50CmVuZAoKdGFzay5zcGF3bihmdW5jdGlvbigpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgdXBkYXRlSXRlbUNvdW50KCkKICAgICAgICB0YXNrLndhaXQoMC4yNSkKICAgIGVuZAplbmQpCgoKLS0tIENyZWRpdHMKCnRhYjc6QWRkTGFiZWwoIiAiKS5UZXh0U2l6ZSA9IDIwCgp0YWI3OkFkZExhYmVsKCJTY3JpcHQgTWFkZSBCeSBIM0xMIFNlbiAvIFJNUEcgU2VuIikuVGV4dFNpemUgPSAyMAoKdGFiNzpBZGRMYWJlbCgiRnJlZSBWZXJzaW9uIikuVGV4dFNpemUgPSAyMAoKdGFiNzpBZGRMYWJlbCgiRGlzY29yZDogemhlZDcxNjMiKS5UZXh0U2l6ZSA9IDIwCgp0YWI3OkFkZExhYmVsKCIgIikuVGV4dFNpemUgPSAxNQp0YWI3OkFkZExhYmVsKCJDTE9TRSBSTVBHIE1FTUJFUlMiKS5UZXh0U2l6ZSA9IDIwCnRhYjc6QWRkTGFiZWwoIklzaGkiKS5UZXh0U2l6ZSA9IDIwCnRhYjc6QWRkTGFiZWwoIllvc2hpcm8gU2lib2wiKS5UZXh0U2l6ZSA9IDIwCnRhYjc6QWRkTGFiZWwoIkplcmFsZCIpLlRleHRTaXplID0gMjAKdGFiNzpBZGRMYWJlbCgiS2F6dXJlaSIpLlRleHRTaXplID0gMjAg" local __map = {}; (function() local chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/' for i=1,#chars do __map[string.sub(chars,i,i)] = i-1 end end)() local out = {}; local i=1; while i <= #__b do local c1 = __map[string.sub(__b,i,i)]; local c2 = __map[string.sub(__b,i+1,i+1)]; local c3 = __map[string.sub(__b,i+2,i+2)]; local c4 = __map[string.sub(__b,i+3,i+3)]; if not c1 then break end; c2 = c2 or 0; c3 = c3 or 0; c4 = c4 or 0; local n = c1*262144 + c2*4096 + c3*64 + c4; local b1 = math.floor(n/65536) % 256; local b2 = math.floor(n/256) % 256; local b3 = n % 256; out[#out+1] = string.char(b1); if string.sub(__b,i+2,i+2) ~= '=' then out[#out+1] = string.char(b2) end; if string.sub(__b,i+3,i+3) ~= '=' then out[#out+1] = string.char(b3) end; i = i + 4 end; local decoded = table.concat(out) local ok,err = pcall(function() local loader = loadstring or load local f = loader(decoded) if type(f) == 'function' then f() end end) if not ok then pcall(function() print('RMPG wrapper error: '..tostring(err)) end) end end)()
